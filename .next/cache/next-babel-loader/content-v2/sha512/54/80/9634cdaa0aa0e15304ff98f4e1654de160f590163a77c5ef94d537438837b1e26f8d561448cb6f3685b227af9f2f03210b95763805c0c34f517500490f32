{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport _defineProperty from \"/Users/limengyu/Desktop/private/code/project/show-codes/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"/Users/limengyu/Desktop/private/code/project/show-codes/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"/Users/limengyu/Desktop/private/code/project/show-codes/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/limengyu/Desktop/private/code/project/show-codes/components/EditorContainer.js\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\n// Theirs\nimport React from 'react';\nimport Router from 'next/router';\nimport { useAsyncCallback } from 'actionsack';\nimport Editor from './Editor';\nimport Toasts from './Toasts';\nimport { useAPI } from './ApiContext';\nimport { useAuth } from './AuthContext';\nimport { THEMES } from '../lib/constants';\nimport { updateRouteState } from '../lib/routing';\nimport { getThemes, saveThemes, clearSettings, saveSettings } from '../lib/util';\n\nfunction onReset() {\n  clearSettings();\n  updateRouteState(Router, {});\n\n  if (window.navigator && navigator.serviceWorker) {\n    navigator.serviceWorker.getRegistrations().then(function (registrations) {\n      registrations.forEach(function (registration) {\n        registration.unregister();\n      });\n    });\n  }\n}\n\nfunction toastsReducer(curr, action) {\n  switch (action.type) {\n    case 'ADD':\n      {\n        if (!curr.find(function (t) {\n          return t.children === action.toast.children;\n        })) {\n          return curr.concat(action.toast);\n        }\n\n        return curr;\n      }\n\n    case 'SET':\n      {\n        return action.toasts;\n      }\n  }\n\n  throw new Error('Unsupported action');\n}\n\nfunction EditorContainer(props) {\n  _s();\n\n  var _React$useState = React.useState(THEMES),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      themes = _React$useState2[0],\n      updateThemes = _React$useState2[1];\n\n  var api = useAPI();\n  var user = useAuth();\n\n  var _useAsyncCallback = useAsyncCallback(api.snippet.update),\n      _useAsyncCallback2 = _slicedToArray(_useAsyncCallback, 2),\n      update = _useAsyncCallback2[0],\n      loading = _useAsyncCallback2[1].loading;\n\n  React.useEffect(function () {\n    var storedThemes = getThemes(localStorage) || [];\n\n    if (storedThemes) {\n      updateThemes(function (currentThemes) {\n        return [].concat(_toConsumableArray(storedThemes), _toConsumableArray(currentThemes));\n      });\n    }\n  }, []);\n  React.useEffect(function () {\n    saveThemes(themes.filter(function (_ref) {\n      var custom = _ref.custom;\n      return custom;\n    }));\n  }, [themes]); // XXX use context\n\n  var _React$useState3 = React.useState(props.snippet || null),\n      _React$useState4 = _slicedToArray(_React$useState3, 2),\n      snippet = _React$useState4[0],\n      setSnippet = _React$useState4[1];\n\n  var _React$useReducer = React.useReducer(toastsReducer, []),\n      _React$useReducer2 = _slicedToArray(_React$useReducer, 2),\n      toasts = _React$useReducer2[0],\n      setToasts = _React$useReducer2[1];\n\n  var snippetId = snippet && snippet.id;\n  React.useEffect(function () {\n    if ('/' + (snippetId || '') === props.router.asPath) {\n      return;\n    }\n\n    window.history.pushState(null, null, '/' + (snippetId || '')); // props.router.replace(props.router.asPath, '/' + (snippetId || ''), { shallow: true })\n  }, [snippetId, props.router]);\n\n  function onEditorUpdate(state) {\n    if (loading) {\n      return;\n    }\n\n    if (!user) {\n      updateRouteState(props.router, state);\n      saveSettings(state);\n    } else {\n      var updates = state;\n\n      if (!snippet) {\n        update(snippetId, updates).then(function (newSnippet) {\n          if (newSnippet && newSnippet.id) {\n            setSnippet(newSnippet);\n            setToasts({\n              type: 'ADD',\n              toast: {\n                children: 'Snippet saved!',\n                closable: true\n              }\n            });\n          }\n        });\n      } else if (snippet.userId === user.uid) {\n        update(snippetId, updates).then(function () {\n          setToasts({\n            type: 'ADD',\n            toast: {\n              children: 'Snippet saved!',\n              closable: true\n            }\n          });\n        });\n      }\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Toasts, {\n      toasts: toasts\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Editor, _objectSpread(_objectSpread({}, props), {}, {\n      themes: themes,\n      updateThemes: updateThemes,\n      snippet: snippet,\n      setSnippet: setSnippet,\n      setToasts: setToasts,\n      onUpdate: onEditorUpdate,\n      onReset: onReset\n    }), void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\n_s(EditorContainer, \"bDzzsHWhLTty2XH6ByzMBshfMQY=\", false, function () {\n  return [useAPI, useAuth, useAsyncCallback];\n});\n\n_c = EditorContainer;\nexport default EditorContainer;\n\nvar _c;\n\n$RefreshReg$(_c, \"EditorContainer\");","map":{"version":3,"sources":["/Users/limengyu/Desktop/private/code/project/show-codes/components/EditorContainer.js"],"names":["React","Router","useAsyncCallback","Editor","Toasts","useAPI","useAuth","THEMES","updateRouteState","getThemes","saveThemes","clearSettings","saveSettings","onReset","window","navigator","serviceWorker","getRegistrations","then","registrations","forEach","registration","unregister","toastsReducer","curr","action","type","find","t","children","toast","concat","toasts","Error","EditorContainer","props","useState","themes","updateThemes","api","user","snippet","update","loading","useEffect","storedThemes","localStorage","currentThemes","filter","custom","setSnippet","useReducer","setToasts","snippetId","id","router","asPath","history","pushState","onEditorUpdate","state","updates","newSnippet","closable","userId","uid"],"mappings":"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","sourcesContent":["// Theirs\nimport React from 'react'\nimport Router from 'next/router'\nimport { useAsyncCallback } from 'actionsack'\n\nimport Editor from './Editor'\nimport Toasts from './Toasts'\nimport { useAPI } from './ApiContext'\nimport { useAuth } from './AuthContext'\n\nimport { THEMES } from '../lib/constants'\nimport { updateRouteState } from '../lib/routing'\nimport { getThemes, saveThemes, clearSettings, saveSettings } from '../lib/util'\n\nfunction onReset() {\n  clearSettings()\n  updateRouteState(Router, {})\n\n  if (window.navigator && navigator.serviceWorker) {\n    navigator.serviceWorker.getRegistrations().then(registrations => {\n      registrations.forEach(registration => {\n        registration.unregister()\n      })\n    })\n  }\n}\n\nfunction toastsReducer(curr, action) {\n  switch (action.type) {\n    case 'ADD': {\n      if (!curr.find(t => t.children === action.toast.children)) {\n        return curr.concat(action.toast)\n      }\n      return curr\n    }\n    case 'SET': {\n      return action.toasts\n    }\n  }\n  throw new Error('Unsupported action')\n}\n\nfunction EditorContainer(props) {\n  const [themes, updateThemes] = React.useState(THEMES)\n  const api = useAPI()\n  const user = useAuth()\n  const [update, { loading }] = useAsyncCallback(api.snippet.update)\n\n  React.useEffect(() => {\n    const storedThemes = getThemes(localStorage) || []\n    if (storedThemes) {\n      updateThemes(currentThemes => [...storedThemes, ...currentThemes])\n    }\n  }, [])\n\n  React.useEffect(() => {\n    saveThemes(themes.filter(({ custom }) => custom))\n  }, [themes])\n\n  // XXX use context\n  const [snippet, setSnippet] = React.useState(props.snippet || null)\n  const [toasts, setToasts] = React.useReducer(toastsReducer, [])\n\n  const snippetId = snippet && snippet.id\n  React.useEffect(() => {\n    if ('/' + (snippetId || '') === props.router.asPath) {\n      return\n    }\n    window.history.pushState(null, null, '/' + (snippetId || ''))\n    // props.router.replace(props.router.asPath, '/' + (snippetId || ''), { shallow: true })\n  }, [snippetId, props.router])\n\n  function onEditorUpdate(state) {\n    if (loading) {\n      return\n    }\n\n    if (!user) {\n      updateRouteState(props.router, state)\n      saveSettings(state)\n    } else {\n      const updates = state\n      if (!snippet) {\n        update(snippetId, updates).then(newSnippet => {\n          if (newSnippet && newSnippet.id) {\n            setSnippet(newSnippet)\n            setToasts({\n              type: 'ADD',\n              toast: { children: 'Snippet saved!', closable: true },\n            })\n          }\n        })\n      } else if (snippet.userId === user.uid) {\n        update(snippetId, updates).then(() => {\n          setToasts({\n            type: 'ADD',\n            toast: { children: 'Snippet saved!', closable: true },\n          })\n        })\n      }\n    }\n  }\n\n  return (\n    <>\n      <Toasts toasts={toasts} />\n      <Editor\n        {...props}\n        themes={themes}\n        updateThemes={updateThemes}\n        snippet={snippet}\n        setSnippet={setSnippet}\n        setToasts={setToasts}\n        onUpdate={onEditorUpdate}\n        onReset={onReset}\n      />\n    </>\n  )\n}\n\nexport default EditorContainer\n"]},"metadata":{},"sourceType":"module"}