{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/limengyu/Desktop/private/code/project/show-codes/components/Editor.js\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// Theirs\nimport React from 'react';\nimport Dropzone from 'dropperx';\nimport debounce from 'lodash.debounce';\nimport dynamic from 'next/dynamic'; // Ours\n\nimport ApiContext from './ApiContext';\nimport Dropdown from './Dropdown';\nimport Settings from './Settings';\nimport Toolbar from './Toolbar';\nimport Overlay from './Overlay';\nimport BackgroundSelect from './BackgroundSelect';\nimport Carbon from './Carbon';\nimport ExportMenu from './ExportMenu';\nimport CopyMenu from './CopyMenu';\nimport Themes from './Themes';\nimport TweetButton from './TweetButton';\nimport FontFace from './FontFace';\nimport LanguageIcon from './svg/Language';\nimport { LANGUAGES, LANGUAGE_MIME_HASH, LANGUAGE_MODE_HASH, LANGUAGE_NAME_HASH, DEFAULT_EXPORT_SIZE, COLORS, EXPORT_SIZES_HASH, DEFAULT_CODE, DEFAULT_SETTINGS, DEFAULT_LANGUAGE, DEFAULT_THEME, FONTS } from '../lib/constants';\nimport { serializeState, getRouteState } from '../lib/routing';\nimport { getSettings, unescapeHtml, formatCode, omit, dataURLtoBlob } from '../lib/util';\nimport domtoimage from '../lib/dom-to-image';\n\nconst languageIcon = /*#__PURE__*/_jsxDEV(LanguageIcon, {}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 39,\n  columnNumber: 22\n}, this);\n\nconst SnippetToolbar = dynamic(() => import('./SnippetToolbar'), {\n  loading: () => null,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('./SnippetToolbar')],\n    modules: ['./SnippetToolbar']\n  }\n});\nconst getConfig = omit(['code']);\nconst unsplashPhotographerCredit = /\\n\\n\\/\\/ Photo by.+?on Unsplash/;\n\nclass Editor extends React.Component {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"state\", _objectSpread(_objectSpread(_objectSpread({}, DEFAULT_SETTINGS), this.props.snippet), {}, {\n      loading: true\n    }));\n\n    _defineProperty(this, \"carbonNode\", /*#__PURE__*/React.createRef());\n\n    _defineProperty(this, \"getTheme\", () => this.props.themes.find(t => t.id === this.state.theme) || DEFAULT_THEME);\n\n    _defineProperty(this, \"onUpdate\", debounce(updates => this.props.onUpdate(updates), 750, {\n      trailing: true,\n      leading: true\n    }));\n\n    _defineProperty(this, \"updateState\", updates => this.setState(updates, () => this.onUpdate(this.state)));\n\n    _defineProperty(this, \"updateCode\", code => this.updateState({\n      code\n    }));\n\n    _defineProperty(this, \"updateWidth\", width => this.setState({\n      widthAdjustment: false,\n      width\n    }));\n\n    _defineProperty(this, \"getCarbonImage\", async ({\n      format,\n      type,\n      squared = this.state.squaredImage,\n      exportSize = (EXPORT_SIZES_HASH[this.state.exportSize] || DEFAULT_EXPORT_SIZE).value\n    } = {\n      format: 'png'\n    }) => {\n      const node = this.carbonNode.current;\n      const width = node.offsetWidth * exportSize;\n      const height = squared ? node.offsetWidth * exportSize : node.offsetHeight * exportSize;\n      const config = {\n        style: {\n          transform: `scale(${exportSize})`,\n          'transform-origin': 'center',\n          background: squared ? this.state.backgroundColor : 'none'\n        },\n        filter: n => {\n          if (n.className) {\n            const className = String(n.className);\n\n            if (className.includes('eliminateOnRender')) {\n              return false;\n            }\n\n            if (className.includes('CodeMirror-cursors')) {\n              return false;\n            }\n          }\n\n          return true;\n        },\n        width,\n        height\n      }; // current font-family used\n\n      const fontFamily = this.state.fontFamily; // TODO consolidate type/format to only use one param\n\n      if (format === 'svg') {\n        return domtoimage.toSvg(node, config).then(dataURL => dataURL.replace(/&nbsp;/g, '&#160;') // https://github.com/tsayen/dom-to-image/blob/fae625bce0970b3a039671ea7f338d05ecb3d0e8/src/dom-to-image.js#L551\n        .replace(/%23/g, '#').replace(/%0A/g, '\\n') // https://stackoverflow.com/questions/7604436/xmlparseentityref-no-name-warnings-while-loading-xml-into-a-php-file\n        .replace(/&(?!#?[a-z0-9]+;)/g, '&amp;') // remove other fonts which are not used\n        .replace(new RegExp('@font-face\\\\s+{\\\\s+font-family: (?!\"*' + fontFamily + ').*?}', 'g'), '')).then(uri => uri.slice(uri.indexOf(',') + 1)).then(data => new Blob([data], {\n          type: 'image/svg+xml'\n        }));\n      } // if safari, get image from api\n\n\n      if (this.context.image && this.isSafari) {\n        const themeConfig = this.getTheme(); // pull from custom theme highlights, or state highlights\n\n        const encodedState = serializeState(_objectSpread(_objectSpread({}, this.state), {}, {\n          highlights: _objectSpread(_objectSpread({}, themeConfig.highlights), this.state.highlights)\n        })); // TODO consider returning blob responseType from axios\n\n        return this.context.image(encodedState).then(dataURL => type === 'blob' ? dataURLtoBlob(dataURL) : dataURL);\n      }\n\n      if (type === 'blob') {\n        return domtoimage.toBlob(node, config);\n      } // Twitter needs regular dataURLs\n\n\n      return domtoimage.toPng(node, config);\n    });\n\n    _defineProperty(this, \"tweet\", () => {\n      this.getCarbonImage({\n        format: 'png'\n      }).then(this.context.tweet.bind(null, this.state.code || DEFAULT_CODE));\n    });\n\n    _defineProperty(this, \"exportImage\", (format = 'png', options = {}) => {\n      const link = document.createElement('a');\n      const prefix = options.filename || this.state.name || 'carbon';\n      return this.getCarbonImage({\n        format,\n        type: 'blob'\n      }).then(blob => window.URL.createObjectURL(blob)).then(url => {\n        if (format !== 'open') {\n          link.download = `${prefix}.${format}`;\n        }\n\n        if (this.isFirefox) {\n          link.target = '_blank';\n        }\n\n        link.href = url;\n        document.body.appendChild(link);\n        link.click();\n        link.remove();\n      });\n    });\n\n    _defineProperty(this, \"copyImage\", () => this.getCarbonImage({\n      format: 'png',\n      type: 'blob'\n    }).then(blob => navigator.clipboard.write([new window.ClipboardItem({\n      [blob.type]: blob\n    })])).catch(console.error));\n\n    _defineProperty(this, \"updateSetting\", (key, value) => {\n      this.updateState({\n        [key]: value\n      });\n\n      if (Object.prototype.hasOwnProperty.call(DEFAULT_SETTINGS, key)) {\n        this.updateState({\n          preset: null\n        });\n      }\n    });\n\n    _defineProperty(this, \"resetDefaultSettings\", () => {\n      this.updateState(DEFAULT_SETTINGS);\n      this.props.onReset();\n    });\n\n    _defineProperty(this, \"onDrop\", ([file]) => {\n      if (file.type.split('/')[0] === 'image') {\n        this.updateState({\n          backgroundImage: file.content,\n          backgroundImageSelection: null,\n          backgroundMode: 'image',\n          preset: null\n        });\n      } else {\n        this.updateState({\n          code: file.content,\n          language: 'auto'\n        });\n      }\n    });\n\n    _defineProperty(this, \"updateLanguage\", language => {\n      if (language) {\n        this.updateSetting('language', language.mime || language.mode);\n      }\n    });\n\n    _defineProperty(this, \"updateBackground\", (_ref = {}) => {\n      let {\n        photographer\n      } = _ref,\n          changes = _objectWithoutProperties(_ref, [\"photographer\"]);\n\n      if (photographer) {\n        this.updateState(({\n          code = DEFAULT_CODE\n        }) => _objectSpread(_objectSpread({}, changes), {}, {\n          code: code.replace(unsplashPhotographerCredit, '') + `\\n\\n// Photo by ${photographer.name} on Unsplash`,\n          preset: null\n        }));\n      } else {\n        this.updateState(_objectSpread(_objectSpread({}, changes), {}, {\n          preset: null\n        }));\n      }\n    });\n\n    _defineProperty(this, \"updateTheme\", theme => this.updateState({\n      theme\n    }));\n\n    _defineProperty(this, \"updateHighlights\", updates => this.setState(({\n      highlights = {}\n    }) => ({\n      highlights: _objectSpread(_objectSpread({}, highlights), updates)\n    })));\n\n    _defineProperty(this, \"createTheme\", theme => {\n      this.props.updateThemes(themes => [theme, ...themes]);\n      this.updateTheme(theme.id);\n    });\n\n    _defineProperty(this, \"removeTheme\", id => {\n      this.props.updateThemes(themes => themes.filter(t => t.id !== id));\n\n      if (this.state.theme.id === id) {\n        this.updateTheme(DEFAULT_THEME.id);\n      }\n    });\n\n    _defineProperty(this, \"applyPreset\", (_ref2) => {\n      let {\n        id: preset\n      } = _ref2,\n          settings = _objectWithoutProperties(_ref2, [\"id\"]);\n\n      return this.updateState(_objectSpread({\n        preset\n      }, settings));\n    });\n\n    _defineProperty(this, \"format\", () => formatCode(this.state.code).then(this.updateCode).catch(() => {// create toast here in the future\n    }));\n\n    _defineProperty(this, \"handleSnippetCreate\", () => this.context.snippet.create(this.state).then(data => this.props.setSnippet(data)).then(() => this.props.setToasts({\n      type: 'SET',\n      toasts: [{\n        children: 'Snippet duplicated!',\n        timeout: 3000\n      }]\n    })));\n\n    _defineProperty(this, \"handleSnippetDelete\", () => this.context.snippet.delete(this.props.snippet.id).then(() => this.props.setSnippet(null)).then(() => this.props.setToasts({\n      type: 'SET',\n      toasts: [{\n        children: 'Snippet deleted',\n        timeout: 3000\n      }]\n    })));\n  }\n\n  async componentDidMount() {\n    const {\n      queryState\n    } = getRouteState(this.props.router);\n\n    const newState = _objectSpread(_objectSpread(_objectSpread({}, this.props.snippet ? null : getSettings(localStorage)), queryState), {}, {\n      loading: false\n    }); // Makes sure the slash in 'application/X' is decoded\n\n\n    if (newState.language) {\n      newState.language = unescapeHtml(newState.language);\n    }\n\n    if (newState.fontFamily && !FONTS.find(({\n      id\n    }) => id === newState.fontFamily)) {\n      newState.fontFamily = DEFAULT_SETTINGS.fontFamily;\n    }\n\n    this.setState(newState);\n    this.isSafari = window.navigator && window.navigator.userAgent.indexOf('Safari') !== -1 && window.navigator.userAgent.indexOf('Chrome') === -1;\n    this.isFirefox = window.navigator && window.navigator.userAgent.indexOf('Firefox') !== -1 && window.navigator.userAgent.indexOf('Chrome') === -1;\n  }\n\n  render() {\n    const {\n      highlights,\n      language,\n      backgroundColor,\n      backgroundImage,\n      backgroundMode,\n      code,\n      exportSize\n    } = this.state;\n    const config = getConfig(this.state);\n    const theme = this.getTheme();\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: _JSXStyle.dynamic([[\"1079899087\", [COLORS.BLACK, COLORS.SECONDARY]]]) + \" \" + \"editor\",\n      children: [/*#__PURE__*/_jsxDEV(Toolbar, {\n        children: [/*#__PURE__*/_jsxDEV(Themes, {\n          theme: theme,\n          highlights: highlights,\n          update: this.updateTheme,\n          updateHighlights: this.updateHighlights,\n          remove: this.removeTheme,\n          create: this.createTheme,\n          themes: this.props.themes\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Dropdown, {\n          title: \"Language\",\n          icon: languageIcon,\n          selected: LANGUAGE_NAME_HASH[language] || LANGUAGE_MIME_HASH[language] || LANGUAGE_MODE_HASH[language] || LANGUAGE_MODE_HASH[DEFAULT_LANGUAGE],\n          list: LANGUAGES,\n          onChange: this.updateLanguage\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: _JSXStyle.dynamic([[\"1079899087\", [COLORS.BLACK, COLORS.SECONDARY]]]) + \" \" + \"toolbar-second-row\",\n          children: [/*#__PURE__*/_jsxDEV(BackgroundSelect, {\n            onChange: this.updateBackground,\n            updateHighlights: this.updateHighlights,\n            mode: backgroundMode,\n            color: backgroundColor,\n            image: backgroundImage,\n            carbonRef: this.carbonNode.current\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 362,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Settings, _objectSpread(_objectSpread({}, config), {}, {\n            onChange: this.updateSetting,\n            resetDefaultSettings: this.resetDefaultSettings,\n            format: this.format,\n            applyPreset: this.applyPreset,\n            getCarbonImage: this.getCarbonImage\n          }), void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 370,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            id: \"style-editor-button\",\n            className: _JSXStyle.dynamic([[\"1079899087\", [COLORS.BLACK, COLORS.SECONDARY]]])\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: _JSXStyle.dynamic([[\"1079899087\", [COLORS.BLACK, COLORS.SECONDARY]]]) + \" \" + \"buttons\",\n            children: [/*#__PURE__*/_jsxDEV(CopyMenu, {\n              copyImage: this.copyImage,\n              carbonRef: this.carbonNode.current\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 380,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(TweetButton, {\n              onClick: this.tweet\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 381,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ExportMenu, {\n              onChange: this.updateSetting,\n              exportImage: this.exportImage,\n              exportSize: exportSize,\n              backgroundImage: backgroundImage\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 382,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 379,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Dropzone, {\n        accept: \"image/*, text/*, application/*\",\n        onDrop: this.onDrop,\n        children: ({\n          canDrop\n        }) => /*#__PURE__*/_jsxDEV(Overlay, {\n          isOver: canDrop,\n          title: `Drop your file here to import ${canDrop ? '✋' : '✊'}`,\n          children: /*#__PURE__*/_jsxDEV(Carbon, {\n            ref: this.carbonNode,\n            config: this.state,\n            onChange: this.updateCode,\n            updateWidth: this.updateWidth,\n            loading: this.state.loading,\n            theme: theme,\n            children: code != null ? code : DEFAULT_CODE\n          }, language, false, {\n            fileName: _jsxFileName,\n            lineNumber: 399,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 394,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 392,\n        columnNumber: 9\n      }, this), this.props.snippet && /*#__PURE__*/_jsxDEV(SnippetToolbar, {\n        snippet: this.props.snippet,\n        onCreate: this.handleSnippetCreate,\n        onDelete: this.handleSnippetDelete,\n        name: config.name,\n        onChange: this.updateSetting\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(FontFace, _objectSpread({}, config), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(_JSXStyle, {\n        id: \"1079899087\",\n        dynamic: [COLORS.BLACK, COLORS.SECONDARY],\n        children: `.editor.__jsx-style-dynamic-selector{background:${COLORS.BLACK};border:3px solid ${COLORS.SECONDARY};border-radius:8px;padding:16px;}.buttons.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-left:auto;}.toolbar-second-row.__jsx-style-dynamic-selector{height:40px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;}.toolbar-second-row.__jsx-style-dynamic-selector>div:not(:last-of-type){margin-right:0.5rem;}#style-editor-button.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9saW1lbmd5dS9EZXNrdG9wL3ByaXZhdGUvY29kZS9wcm9qZWN0L3Nob3ctY29kZXMvY29tcG9uZW50cy9FZGl0b3IuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBdWFXLEFBR3VELEFBTzNCLEFBSUQsQUFLUSxBQUlQLFlBUkEsUUFLZixvQkFoQmdELGtDQU83QixBQWFFLFlBbkJELEFBV0osS0FKaEIsYUFOZSxhQUNmLHVCQVVBLDJCQVFBIiwiZmlsZSI6Ii9Vc2Vycy9saW1lbmd5dS9EZXNrdG9wL3ByaXZhdGUvY29kZS9wcm9qZWN0L3Nob3ctY29kZXMvY29tcG9uZW50cy9FZGl0b3IuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBUaGVpcnNcbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCBEcm9wem9uZSBmcm9tICdkcm9wcGVyeCdcbmltcG9ydCBkZWJvdW5jZSBmcm9tICdsb2Rhc2guZGVib3VuY2UnXG5pbXBvcnQgZHluYW1pYyBmcm9tICduZXh0L2R5bmFtaWMnXG5cbi8vIE91cnNcbmltcG9ydCBBcGlDb250ZXh0IGZyb20gJy4vQXBpQ29udGV4dCdcbmltcG9ydCBEcm9wZG93biBmcm9tICcuL0Ryb3Bkb3duJ1xuaW1wb3J0IFNldHRpbmdzIGZyb20gJy4vU2V0dGluZ3MnXG5pbXBvcnQgVG9vbGJhciBmcm9tICcuL1Rvb2xiYXInXG5pbXBvcnQgT3ZlcmxheSBmcm9tICcuL092ZXJsYXknXG5pbXBvcnQgQmFja2dyb3VuZFNlbGVjdCBmcm9tICcuL0JhY2tncm91bmRTZWxlY3QnXG5pbXBvcnQgQ2FyYm9uIGZyb20gJy4vQ2FyYm9uJ1xuaW1wb3J0IEV4cG9ydE1lbnUgZnJvbSAnLi9FeHBvcnRNZW51J1xuaW1wb3J0IENvcHlNZW51IGZyb20gJy4vQ29weU1lbnUnXG5pbXBvcnQgVGhlbWVzIGZyb20gJy4vVGhlbWVzJ1xuaW1wb3J0IFR3ZWV0QnV0dG9uIGZyb20gJy4vVHdlZXRCdXR0b24nXG5pbXBvcnQgRm9udEZhY2UgZnJvbSAnLi9Gb250RmFjZSdcbmltcG9ydCBMYW5ndWFnZUljb24gZnJvbSAnLi9zdmcvTGFuZ3VhZ2UnXG5pbXBvcnQge1xuICBMQU5HVUFHRVMsXG4gIExBTkdVQUdFX01JTUVfSEFTSCxcbiAgTEFOR1VBR0VfTU9ERV9IQVNILFxuICBMQU5HVUFHRV9OQU1FX0hBU0gsXG4gIERFRkFVTFRfRVhQT1JUX1NJWkUsXG4gIENPTE9SUyxcbiAgRVhQT1JUX1NJWkVTX0hBU0gsXG4gIERFRkFVTFRfQ09ERSxcbiAgREVGQVVMVF9TRVRUSU5HUyxcbiAgREVGQVVMVF9MQU5HVUFHRSxcbiAgREVGQVVMVF9USEVNRSxcbiAgRk9OVFMsXG59IGZyb20gJy4uL2xpYi9jb25zdGFudHMnXG5pbXBvcnQgeyBzZXJpYWxpemVTdGF0ZSwgZ2V0Um91dGVTdGF0ZSB9IGZyb20gJy4uL2xpYi9yb3V0aW5nJ1xuaW1wb3J0IHsgZ2V0U2V0dGluZ3MsIHVuZXNjYXBlSHRtbCwgZm9ybWF0Q29kZSwgb21pdCwgZGF0YVVSTHRvQmxvYiB9IGZyb20gJy4uL2xpYi91dGlsJ1xuaW1wb3J0IGRvbXRvaW1hZ2UgZnJvbSAnLi4vbGliL2RvbS10by1pbWFnZSdcblxuY29uc3QgbGFuZ3VhZ2VJY29uID0gPExhbmd1YWdlSWNvbiAvPlxuXG5jb25zdCBTbmlwcGV0VG9vbGJhciA9IGR5bmFtaWMoKCkgPT4gaW1wb3J0KCcuL1NuaXBwZXRUb29sYmFyJyksIHtcbiAgbG9hZGluZzogKCkgPT4gbnVsbCxcbn0pXG5cbmNvbnN0IGdldENvbmZpZyA9IG9taXQoWydjb2RlJ10pXG5jb25zdCB1bnNwbGFzaFBob3RvZ3JhcGhlckNyZWRpdCA9IC9cXG5cXG5cXC9cXC8gUGhvdG8gYnkuKz9vbiBVbnNwbGFzaC9cblxuY2xhc3MgRWRpdG9yIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgc3RhdGljIGNvbnRleHRUeXBlID0gQXBpQ29udGV4dFxuXG4gIHN0YXRlID0ge1xuICAgIC4uLkRFRkFVTFRfU0VUVElOR1MsXG4gICAgLi4udGhpcy5wcm9wcy5zbmlwcGV0LFxuICAgIGxvYWRpbmc6IHRydWUsXG4gIH1cblxuICBhc3luYyBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICBjb25zdCB7IHF1ZXJ5U3RhdGUgfSA9IGdldFJvdXRlU3RhdGUodGhpcy5wcm9wcy5yb3V0ZXIpXG5cbiAgICBjb25zdCBuZXdTdGF0ZSA9IHtcbiAgICAgIC8vIElERUE6IHdlIGNvdWxkIGNyZWF0ZSBhbiBpbnRlcmZhY2UgZm9yIGxvYWRpbmcgdGhpcyBjb25maWcsIHNvIHRoYXQgaXQgbG9va3MgaWRlbnRpY2FsXG4gICAgICAvLyB3aGV0aGVyIGNvbmZpZyBpcyBsb2FkZWQgZnJvbSBsb2NhbFN0b3JhZ2UsIGdpc3QsIG9yIGV2ZW4gc29tZXRoaW5nIGxpa2UgSW5kZXhEQlxuICAgICAgLy8gTG9hZCBvcHRpb25zIGZyb20gZ2lzdCBvciBsb2NhbFN0b3JhZ2VcbiAgICAgIC4uLih0aGlzLnByb3BzLnNuaXBwZXQgPyBudWxsIDogZ2V0U2V0dGluZ3MobG9jYWxTdG9yYWdlKSksXG4gICAgICAvLyBhbmQgdGhlbiBVUkwgcGFyYW1zXG4gICAgICAuLi5xdWVyeVN0YXRlLFxuICAgICAgbG9hZGluZzogZmFsc2UsXG4gICAgfVxuXG4gICAgLy8gTWFrZXMgc3VyZSB0aGUgc2xhc2ggaW4gJ2FwcGxpY2F0aW9uL1gnIGlzIGRlY29kZWRcbiAgICBpZiAobmV3U3RhdGUubGFuZ3VhZ2UpIHtcbiAgICAgIG5ld1N0YXRlLmxhbmd1YWdlID0gdW5lc2NhcGVIdG1sKG5ld1N0YXRlLmxhbmd1YWdlKVxuICAgIH1cblxuICAgIGlmIChuZXdTdGF0ZS5mb250RmFtaWx5ICYmICFGT05UUy5maW5kKCh7IGlkIH0pID0+IGlkID09PSBuZXdTdGF0ZS5mb250RmFtaWx5KSkge1xuICAgICAgbmV3U3RhdGUuZm9udEZhbWlseSA9IERFRkFVTFRfU0VUVElOR1MuZm9udEZhbWlseVxuICAgIH1cblxuICAgIHRoaXMuc2V0U3RhdGUobmV3U3RhdGUpXG5cbiAgICB0aGlzLmlzU2FmYXJpID1cbiAgICAgIHdpbmRvdy5uYXZpZ2F0b3IgJiZcbiAgICAgIHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1NhZmFyaScpICE9PSAtMSAmJlxuICAgICAgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgPT09IC0xXG4gICAgdGhpcy5pc0ZpcmVmb3ggPVxuICAgICAgd2luZG93Lm5hdmlnYXRvciAmJlxuICAgICAgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpICE9PSAtMSAmJlxuICAgICAgd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZignQ2hyb21lJykgPT09IC0xXG4gIH1cblxuICBjYXJib25Ob2RlID0gUmVhY3QuY3JlYXRlUmVmKClcblxuICBnZXRUaGVtZSA9ICgpID0+IHRoaXMucHJvcHMudGhlbWVzLmZpbmQodCA9PiB0LmlkID09PSB0aGlzLnN0YXRlLnRoZW1lKSB8fCBERUZBVUxUX1RIRU1FXG5cbiAgb25VcGRhdGUgPSBkZWJvdW5jZSh1cGRhdGVzID0+IHRoaXMucHJvcHMub25VcGRhdGUodXBkYXRlcyksIDc1MCwge1xuICAgIHRyYWlsaW5nOiB0cnVlLFxuICAgIGxlYWRpbmc6IHRydWUsXG4gIH0pXG5cbiAgdXBkYXRlU3RhdGUgPSB1cGRhdGVzID0+IHRoaXMuc2V0U3RhdGUodXBkYXRlcywgKCkgPT4gdGhpcy5vblVwZGF0ZSh0aGlzLnN0YXRlKSlcblxuICB1cGRhdGVDb2RlID0gY29kZSA9PiB0aGlzLnVwZGF0ZVN0YXRlKHsgY29kZSB9KVxuICB1cGRhdGVXaWR0aCA9IHdpZHRoID0+IHRoaXMuc2V0U3RhdGUoeyB3aWR0aEFkanVzdG1lbnQ6IGZhbHNlLCB3aWR0aCB9KVxuXG4gIGdldENhcmJvbkltYWdlID0gYXN5bmMgKFxuICAgIHtcbiAgICAgIGZvcm1hdCxcbiAgICAgIHR5cGUsXG4gICAgICBzcXVhcmVkID0gdGhpcy5zdGF0ZS5zcXVhcmVkSW1hZ2UsXG4gICAgICBleHBvcnRTaXplID0gKEVYUE9SVF9TSVpFU19IQVNIW3RoaXMuc3RhdGUuZXhwb3J0U2l6ZV0gfHwgREVGQVVMVF9FWFBPUlRfU0laRSkudmFsdWUsXG4gICAgfSA9IHsgZm9ybWF0OiAncG5nJyB9XG4gICkgPT4ge1xuICAgIGNvbnN0IG5vZGUgPSB0aGlzLmNhcmJvbk5vZGUuY3VycmVudFxuXG4gICAgY29uc3Qgd2lkdGggPSBub2RlLm9mZnNldFdpZHRoICogZXhwb3J0U2l6ZVxuICAgIGNvbnN0IGhlaWdodCA9IHNxdWFyZWQgPyBub2RlLm9mZnNldFdpZHRoICogZXhwb3J0U2l6ZSA6IG5vZGUub2Zmc2V0SGVpZ2h0ICogZXhwb3J0U2l6ZVxuXG4gICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgc3R5bGU6IHtcbiAgICAgICAgdHJhbnNmb3JtOiBgc2NhbGUoJHtleHBvcnRTaXplfSlgLFxuICAgICAgICAndHJhbnNmb3JtLW9yaWdpbic6ICdjZW50ZXInLFxuICAgICAgICBiYWNrZ3JvdW5kOiBzcXVhcmVkID8gdGhpcy5zdGF0ZS5iYWNrZ3JvdW5kQ29sb3IgOiAnbm9uZScsXG4gICAgICB9LFxuICAgICAgZmlsdGVyOiBuID0+IHtcbiAgICAgICAgaWYgKG4uY2xhc3NOYW1lKSB7XG4gICAgICAgICAgY29uc3QgY2xhc3NOYW1lID0gU3RyaW5nKG4uY2xhc3NOYW1lKVxuICAgICAgICAgIGlmIChjbGFzc05hbWUuaW5jbHVkZXMoJ2VsaW1pbmF0ZU9uUmVuZGVyJykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY2xhc3NOYW1lLmluY2x1ZGVzKCdDb2RlTWlycm9yLWN1cnNvcnMnKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgICB9LFxuICAgICAgd2lkdGgsXG4gICAgICBoZWlnaHQsXG4gICAgfVxuXG4gICAgLy8gY3VycmVudCBmb250LWZhbWlseSB1c2VkXG4gICAgY29uc3QgZm9udEZhbWlseSA9IHRoaXMuc3RhdGUuZm9udEZhbWlseVxuXG4gICAgLy8gVE9ETyBjb25zb2xpZGF0ZSB0eXBlL2Zvcm1hdCB0byBvbmx5IHVzZSBvbmUgcGFyYW1cbiAgICBpZiAoZm9ybWF0ID09PSAnc3ZnJykge1xuICAgICAgcmV0dXJuIGRvbXRvaW1hZ2VcbiAgICAgICAgLnRvU3ZnKG5vZGUsIGNvbmZpZylcbiAgICAgICAgLnRoZW4oZGF0YVVSTCA9PlxuICAgICAgICAgIGRhdGFVUkxcbiAgICAgICAgICAgIC5yZXBsYWNlKC8mbmJzcDsvZywgJyYjMTYwOycpXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vdHNheWVuL2RvbS10by1pbWFnZS9ibG9iL2ZhZTYyNWJjZTA5NzBiM2EwMzk2NzFlYTdmMzM4ZDA1ZWNiM2QwZTgvc3JjL2RvbS10by1pbWFnZS5qcyNMNTUxXG4gICAgICAgICAgICAucmVwbGFjZSgvJTIzL2csICcjJylcbiAgICAgICAgICAgIC5yZXBsYWNlKC8lMEEvZywgJ1xcbicpXG4gICAgICAgICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy83NjA0NDM2L3htbHBhcnNlZW50aXR5cmVmLW5vLW5hbWUtd2FybmluZ3Mtd2hpbGUtbG9hZGluZy14bWwtaW50by1hLXBocC1maWxlXG4gICAgICAgICAgICAucmVwbGFjZSgvJig/ISM/W2EtejAtOV0rOykvZywgJyZhbXA7JylcbiAgICAgICAgICAgIC8vIHJlbW92ZSBvdGhlciBmb250cyB3aGljaCBhcmUgbm90IHVzZWRcbiAgICAgICAgICAgIC5yZXBsYWNlKFxuICAgICAgICAgICAgICBuZXcgUmVnRXhwKCdAZm9udC1mYWNlXFxcXHMre1xcXFxzK2ZvbnQtZmFtaWx5OiAoPyFcIionICsgZm9udEZhbWlseSArICcpLio/fScsICdnJyksXG4gICAgICAgICAgICAgICcnXG4gICAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLnRoZW4odXJpID0+IHVyaS5zbGljZSh1cmkuaW5kZXhPZignLCcpICsgMSkpXG4gICAgICAgIC50aGVuKGRhdGEgPT4gbmV3IEJsb2IoW2RhdGFdLCB7IHR5cGU6ICdpbWFnZS9zdmcreG1sJyB9KSlcbiAgICB9XG5cbiAgICAvLyBpZiBzYWZhcmksIGdldCBpbWFnZSBmcm9tIGFwaVxuICAgIGlmICh0aGlzLmNvbnRleHQuaW1hZ2UgJiYgdGhpcy5pc1NhZmFyaSkge1xuICAgICAgY29uc3QgdGhlbWVDb25maWcgPSB0aGlzLmdldFRoZW1lKClcbiAgICAgIC8vIHB1bGwgZnJvbSBjdXN0b20gdGhlbWUgaGlnaGxpZ2h0cywgb3Igc3RhdGUgaGlnaGxpZ2h0c1xuICAgICAgY29uc3QgZW5jb2RlZFN0YXRlID0gc2VyaWFsaXplU3RhdGUoe1xuICAgICAgICAuLi50aGlzLnN0YXRlLFxuICAgICAgICBoaWdobGlnaHRzOiB7IC4uLnRoZW1lQ29uZmlnLmhpZ2hsaWdodHMsIC4uLnRoaXMuc3RhdGUuaGlnaGxpZ2h0cyB9LFxuICAgICAgfSlcbiAgICAgIC8vIFRPRE8gY29uc2lkZXIgcmV0dXJuaW5nIGJsb2IgcmVzcG9uc2VUeXBlIGZyb20gYXhpb3NcbiAgICAgIHJldHVybiB0aGlzLmNvbnRleHRcbiAgICAgICAgLmltYWdlKGVuY29kZWRTdGF0ZSlcbiAgICAgICAgLnRoZW4oZGF0YVVSTCA9PiAodHlwZSA9PT0gJ2Jsb2InID8gZGF0YVVSTHRvQmxvYihkYXRhVVJMKSA6IGRhdGFVUkwpKVxuICAgIH1cblxuICAgIGlmICh0eXBlID09PSAnYmxvYicpIHtcbiAgICAgIHJldHVybiBkb210b2ltYWdlLnRvQmxvYihub2RlLCBjb25maWcpXG4gICAgfVxuXG4gICAgLy8gVHdpdHRlciBuZWVkcyByZWd1bGFyIGRhdGFVUkxzXG4gICAgcmV0dXJuIGRvbXRvaW1hZ2UudG9Qbmcobm9kZSwgY29uZmlnKVxuICB9XG5cbiAgdHdlZXQgPSAoKSA9PiB7XG4gICAgdGhpcy5nZXRDYXJib25JbWFnZSh7IGZvcm1hdDogJ3BuZycgfSkudGhlbihcbiAgICAgIHRoaXMuY29udGV4dC50d2VldC5iaW5kKG51bGwsIHRoaXMuc3RhdGUuY29kZSB8fCBERUZBVUxUX0NPREUpXG4gICAgKVxuICB9XG5cbiAgZXhwb3J0SW1hZ2UgPSAoZm9ybWF0ID0gJ3BuZycsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICAgIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJylcblxuICAgIGNvbnN0IHByZWZpeCA9IG9wdGlvbnMuZmlsZW5hbWUgfHwgdGhpcy5zdGF0ZS5uYW1lIHx8ICdjYXJib24nXG5cbiAgICByZXR1cm4gdGhpcy5nZXRDYXJib25JbWFnZSh7IGZvcm1hdCwgdHlwZTogJ2Jsb2InIH0pXG4gICAgICAudGhlbihibG9iID0+IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpKVxuICAgICAgLnRoZW4odXJsID0+IHtcbiAgICAgICAgaWYgKGZvcm1hdCAhPT0gJ29wZW4nKSB7XG4gICAgICAgICAgbGluay5kb3dubG9hZCA9IGAke3ByZWZpeH0uJHtmb3JtYXR9YFxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmlzRmlyZWZveCkge1xuICAgICAgICAgIGxpbmsudGFyZ2V0ID0gJ19ibGFuaydcbiAgICAgICAgfVxuICAgICAgICBsaW5rLmhyZWYgPSB1cmxcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rKVxuICAgICAgICBsaW5rLmNsaWNrKClcbiAgICAgICAgbGluay5yZW1vdmUoKVxuICAgICAgfSlcbiAgfVxuXG4gIGNvcHlJbWFnZSA9ICgpID0+XG4gICAgdGhpcy5nZXRDYXJib25JbWFnZSh7IGZvcm1hdDogJ3BuZycsIHR5cGU6ICdibG9iJyB9KVxuICAgICAgLnRoZW4oYmxvYiA9PlxuICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlKFtcbiAgICAgICAgICBuZXcgd2luZG93LkNsaXBib2FyZEl0ZW0oe1xuICAgICAgICAgICAgW2Jsb2IudHlwZV06IGJsb2IsXG4gICAgICAgICAgfSksXG4gICAgICAgIF0pXG4gICAgICApXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcblxuICB1cGRhdGVTZXR0aW5nID0gKGtleSwgdmFsdWUpID0+IHtcbiAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgW2tleV06IHZhbHVlIH0pXG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChERUZBVUxUX1NFVFRJTkdTLCBrZXkpKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlKHsgcHJlc2V0OiBudWxsIH0pXG4gICAgfVxuICB9XG5cbiAgcmVzZXREZWZhdWx0U2V0dGluZ3MgPSAoKSA9PiB7XG4gICAgdGhpcy51cGRhdGVTdGF0ZShERUZBVUxUX1NFVFRJTkdTKVxuICAgIHRoaXMucHJvcHMub25SZXNldCgpXG4gIH1cblxuICBvbkRyb3AgPSAoW2ZpbGVdKSA9PiB7XG4gICAgaWYgKGZpbGUudHlwZS5zcGxpdCgnLycpWzBdID09PSAnaW1hZ2UnKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlKHtcbiAgICAgICAgYmFja2dyb3VuZEltYWdlOiBmaWxlLmNvbnRlbnQsXG4gICAgICAgIGJhY2tncm91bmRJbWFnZVNlbGVjdGlvbjogbnVsbCxcbiAgICAgICAgYmFja2dyb3VuZE1vZGU6ICdpbWFnZScsXG4gICAgICAgIHByZXNldDogbnVsbCxcbiAgICAgIH0pXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyBjb2RlOiBmaWxlLmNvbnRlbnQsIGxhbmd1YWdlOiAnYXV0bycgfSlcbiAgICB9XG4gIH1cblxuICB1cGRhdGVMYW5ndWFnZSA9IGxhbmd1YWdlID0+IHtcbiAgICBpZiAobGFuZ3VhZ2UpIHtcbiAgICAgIHRoaXMudXBkYXRlU2V0dGluZygnbGFuZ3VhZ2UnLCBsYW5ndWFnZS5taW1lIHx8IGxhbmd1YWdlLm1vZGUpXG4gICAgfVxuICB9XG5cbiAgdXBkYXRlQmFja2dyb3VuZCA9ICh7IHBob3RvZ3JhcGhlciwgLi4uY2hhbmdlcyB9ID0ge30pID0+IHtcbiAgICBpZiAocGhvdG9ncmFwaGVyKSB7XG4gICAgICB0aGlzLnVwZGF0ZVN0YXRlKCh7IGNvZGUgPSBERUZBVUxUX0NPREUgfSkgPT4gKHtcbiAgICAgICAgLi4uY2hhbmdlcyxcbiAgICAgICAgY29kZTpcbiAgICAgICAgICBjb2RlLnJlcGxhY2UodW5zcGxhc2hQaG90b2dyYXBoZXJDcmVkaXQsICcnKSArXG4gICAgICAgICAgYFxcblxcbi8vIFBob3RvIGJ5ICR7cGhvdG9ncmFwaGVyLm5hbWV9IG9uIFVuc3BsYXNoYCxcbiAgICAgICAgcHJlc2V0OiBudWxsLFxuICAgICAgfSkpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudXBkYXRlU3RhdGUoeyAuLi5jaGFuZ2VzLCBwcmVzZXQ6IG51bGwgfSlcbiAgICB9XG4gIH1cblxuICB1cGRhdGVUaGVtZSA9IHRoZW1lID0+IHRoaXMudXBkYXRlU3RhdGUoeyB0aGVtZSB9KVxuICB1cGRhdGVIaWdobGlnaHRzID0gdXBkYXRlcyA9PlxuICAgIHRoaXMuc2V0U3RhdGUoKHsgaGlnaGxpZ2h0cyA9IHt9IH0pID0+ICh7XG4gICAgICBoaWdobGlnaHRzOiB7XG4gICAgICAgIC4uLmhpZ2hsaWdodHMsXG4gICAgICAgIC4uLnVwZGF0ZXMsXG4gICAgICB9LFxuICAgIH0pKVxuXG4gIGNyZWF0ZVRoZW1lID0gdGhlbWUgPT4ge1xuICAgIHRoaXMucHJvcHMudXBkYXRlVGhlbWVzKHRoZW1lcyA9PiBbdGhlbWUsIC4uLnRoZW1lc10pXG4gICAgdGhpcy51cGRhdGVUaGVtZSh0aGVtZS5pZClcbiAgfVxuXG4gIHJlbW92ZVRoZW1lID0gaWQgPT4ge1xuICAgIHRoaXMucHJvcHMudXBkYXRlVGhlbWVzKHRoZW1lcyA9PiB0aGVtZXMuZmlsdGVyKHQgPT4gdC5pZCAhPT0gaWQpKVxuICAgIGlmICh0aGlzLnN0YXRlLnRoZW1lLmlkID09PSBpZCkge1xuICAgICAgdGhpcy51cGRhdGVUaGVtZShERUZBVUxUX1RIRU1FLmlkKVxuICAgIH1cbiAgfVxuXG4gIGFwcGx5UHJlc2V0ID0gKHsgaWQ6IHByZXNldCwgLi4uc2V0dGluZ3MgfSkgPT4gdGhpcy51cGRhdGVTdGF0ZSh7IHByZXNldCwgLi4uc2V0dGluZ3MgfSlcblxuICBmb3JtYXQgPSAoKSA9PlxuICAgIGZvcm1hdENvZGUodGhpcy5zdGF0ZS5jb2RlKVxuICAgICAgLnRoZW4odGhpcy51cGRhdGVDb2RlKVxuICAgICAgLmNhdGNoKCgpID0+IHtcbiAgICAgICAgLy8gY3JlYXRlIHRvYXN0IGhlcmUgaW4gdGhlIGZ1dHVyZVxuICAgICAgfSlcblxuICBoYW5kbGVTbmlwcGV0Q3JlYXRlID0gKCkgPT5cbiAgICB0aGlzLmNvbnRleHQuc25pcHBldFxuICAgICAgLmNyZWF0ZSh0aGlzLnN0YXRlKVxuICAgICAgLnRoZW4oZGF0YSA9PiB0aGlzLnByb3BzLnNldFNuaXBwZXQoZGF0YSkpXG4gICAgICAudGhlbigoKSA9PlxuICAgICAgICB0aGlzLnByb3BzLnNldFRvYXN0cyh7XG4gICAgICAgICAgdHlwZTogJ1NFVCcsXG4gICAgICAgICAgdG9hc3RzOiBbeyBjaGlsZHJlbjogJ1NuaXBwZXQgZHVwbGljYXRlZCEnLCB0aW1lb3V0OiAzMDAwIH1dLFxuICAgICAgICB9KVxuICAgICAgKVxuXG4gIGhhbmRsZVNuaXBwZXREZWxldGUgPSAoKSA9PlxuICAgIHRoaXMuY29udGV4dC5zbmlwcGV0XG4gICAgICAuZGVsZXRlKHRoaXMucHJvcHMuc25pcHBldC5pZClcbiAgICAgIC50aGVuKCgpID0+IHRoaXMucHJvcHMuc2V0U25pcHBldChudWxsKSlcbiAgICAgIC50aGVuKCgpID0+XG4gICAgICAgIHRoaXMucHJvcHMuc2V0VG9hc3RzKHtcbiAgICAgICAgICB0eXBlOiAnU0VUJyxcbiAgICAgICAgICB0b2FzdHM6IFt7IGNoaWxkcmVuOiAnU25pcHBldCBkZWxldGVkJywgdGltZW91dDogMzAwMCB9XSxcbiAgICAgICAgfSlcbiAgICAgIClcblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgaGlnaGxpZ2h0cyxcbiAgICAgIGxhbmd1YWdlLFxuICAgICAgYmFja2dyb3VuZENvbG9yLFxuICAgICAgYmFja2dyb3VuZEltYWdlLFxuICAgICAgYmFja2dyb3VuZE1vZGUsXG4gICAgICBjb2RlLFxuICAgICAgZXhwb3J0U2l6ZSxcbiAgICB9ID0gdGhpcy5zdGF0ZVxuXG4gICAgY29uc3QgY29uZmlnID0gZ2V0Q29uZmlnKHRoaXMuc3RhdGUpXG5cbiAgICBjb25zdCB0aGVtZSA9IHRoaXMuZ2V0VGhlbWUoKVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZWRpdG9yXCI+XG4gICAgICAgIDxUb29sYmFyPlxuICAgICAgICAgIDxUaGVtZXNcbiAgICAgICAgICAgIHRoZW1lPXt0aGVtZX1cbiAgICAgICAgICAgIGhpZ2hsaWdodHM9e2hpZ2hsaWdodHN9XG4gICAgICAgICAgICB1cGRhdGU9e3RoaXMudXBkYXRlVGhlbWV9XG4gICAgICAgICAgICB1cGRhdGVIaWdobGlnaHRzPXt0aGlzLnVwZGF0ZUhpZ2hsaWdodHN9XG4gICAgICAgICAgICByZW1vdmU9e3RoaXMucmVtb3ZlVGhlbWV9XG4gICAgICAgICAgICBjcmVhdGU9e3RoaXMuY3JlYXRlVGhlbWV9XG4gICAgICAgICAgICB0aGVtZXM9e3RoaXMucHJvcHMudGhlbWVzfVxuICAgICAgICAgIC8+XG4gICAgICAgICAgPERyb3Bkb3duXG4gICAgICAgICAgICB0aXRsZT1cIkxhbmd1YWdlXCJcbiAgICAgICAgICAgIGljb249e2xhbmd1YWdlSWNvbn1cbiAgICAgICAgICAgIHNlbGVjdGVkPXtcbiAgICAgICAgICAgICAgTEFOR1VBR0VfTkFNRV9IQVNIW2xhbmd1YWdlXSB8fFxuICAgICAgICAgICAgICBMQU5HVUFHRV9NSU1FX0hBU0hbbGFuZ3VhZ2VdIHx8XG4gICAgICAgICAgICAgIExBTkdVQUdFX01PREVfSEFTSFtsYW5ndWFnZV0gfHxcbiAgICAgICAgICAgICAgTEFOR1VBR0VfTU9ERV9IQVNIW0RFRkFVTFRfTEFOR1VBR0VdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsaXN0PXtMQU5HVUFHRVN9XG4gICAgICAgICAgICBvbkNoYW5nZT17dGhpcy51cGRhdGVMYW5ndWFnZX1cbiAgICAgICAgICAvPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidG9vbGJhci1zZWNvbmQtcm93XCI+XG4gICAgICAgICAgICA8QmFja2dyb3VuZFNlbGVjdFxuICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy51cGRhdGVCYWNrZ3JvdW5kfVxuICAgICAgICAgICAgICB1cGRhdGVIaWdobGlnaHRzPXt0aGlzLnVwZGF0ZUhpZ2hsaWdodHN9XG4gICAgICAgICAgICAgIG1vZGU9e2JhY2tncm91bmRNb2RlfVxuICAgICAgICAgICAgICBjb2xvcj17YmFja2dyb3VuZENvbG9yfVxuICAgICAgICAgICAgICBpbWFnZT17YmFja2dyb3VuZEltYWdlfVxuICAgICAgICAgICAgICBjYXJib25SZWY9e3RoaXMuY2FyYm9uTm9kZS5jdXJyZW50fVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxTZXR0aW5nc1xuICAgICAgICAgICAgICB7Li4uY29uZmlnfVxuICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy51cGRhdGVTZXR0aW5nfVxuICAgICAgICAgICAgICByZXNldERlZmF1bHRTZXR0aW5ncz17dGhpcy5yZXNldERlZmF1bHRTZXR0aW5nc31cbiAgICAgICAgICAgICAgZm9ybWF0PXt0aGlzLmZvcm1hdH1cbiAgICAgICAgICAgICAgYXBwbHlQcmVzZXQ9e3RoaXMuYXBwbHlQcmVzZXR9XG4gICAgICAgICAgICAgIGdldENhcmJvbkltYWdlPXt0aGlzLmdldENhcmJvbkltYWdlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDxkaXYgaWQ9XCJzdHlsZS1lZGl0b3ItYnV0dG9uXCIgLz5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiYnV0dG9uc1wiPlxuICAgICAgICAgICAgICA8Q29weU1lbnUgY29weUltYWdlPXt0aGlzLmNvcHlJbWFnZX0gY2FyYm9uUmVmPXt0aGlzLmNhcmJvbk5vZGUuY3VycmVudH0gLz5cbiAgICAgICAgICAgICAgPFR3ZWV0QnV0dG9uIG9uQ2xpY2s9e3RoaXMudHdlZXR9IC8+XG4gICAgICAgICAgICAgIDxFeHBvcnRNZW51XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMudXBkYXRlU2V0dGluZ31cbiAgICAgICAgICAgICAgICBleHBvcnRJbWFnZT17dGhpcy5leHBvcnRJbWFnZX1cbiAgICAgICAgICAgICAgICBleHBvcnRTaXplPXtleHBvcnRTaXplfVxuICAgICAgICAgICAgICAgIGJhY2tncm91bmRJbWFnZT17YmFja2dyb3VuZEltYWdlfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvVG9vbGJhcj5cblxuICAgICAgICA8RHJvcHpvbmUgYWNjZXB0PVwiaW1hZ2UvKiwgdGV4dC8qLCBhcHBsaWNhdGlvbi8qXCIgb25Ecm9wPXt0aGlzLm9uRHJvcH0+XG4gICAgICAgICAgeyh7IGNhbkRyb3AgfSkgPT4gKFxuICAgICAgICAgICAgPE92ZXJsYXlcbiAgICAgICAgICAgICAgaXNPdmVyPXtjYW5Ecm9wfVxuICAgICAgICAgICAgICB0aXRsZT17YERyb3AgeW91ciBmaWxlIGhlcmUgdG8gaW1wb3J0ICR7Y2FuRHJvcCA/ICfinIsnIDogJ+Kciid9YH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgey8qa2V5IGVuc3VyZXMgQ2FyYm9uJ3MgaW50ZXJuYWwgbGFuZ3VhZ2Ugc3RhdGUgaXMgdXBkYXRlZCB3aGVuIGl0J3MgY2hhbmdlZCBieSBEcm9wZG93biovfVxuICAgICAgICAgICAgICA8Q2FyYm9uXG4gICAgICAgICAgICAgICAga2V5PXtsYW5ndWFnZX1cbiAgICAgICAgICAgICAgICByZWY9e3RoaXMuY2FyYm9uTm9kZX1cbiAgICAgICAgICAgICAgICBjb25maWc9e3RoaXMuc3RhdGV9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMudXBkYXRlQ29kZX1cbiAgICAgICAgICAgICAgICB1cGRhdGVXaWR0aD17dGhpcy51cGRhdGVXaWR0aH1cbiAgICAgICAgICAgICAgICBsb2FkaW5nPXt0aGlzLnN0YXRlLmxvYWRpbmd9XG4gICAgICAgICAgICAgICAgdGhlbWU9e3RoZW1lfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge2NvZGUgIT0gbnVsbCA/IGNvZGUgOiBERUZBVUxUX0NPREV9XG4gICAgICAgICAgICAgIDwvQ2FyYm9uPlxuICAgICAgICAgICAgPC9PdmVybGF5PlxuICAgICAgICAgICl9XG4gICAgICAgIDwvRHJvcHpvbmU+XG4gICAgICAgIHt0aGlzLnByb3BzLnNuaXBwZXQgJiYgKFxuICAgICAgICAgIDxTbmlwcGV0VG9vbGJhclxuICAgICAgICAgICAgc25pcHBldD17dGhpcy5wcm9wcy5zbmlwcGV0fVxuICAgICAgICAgICAgb25DcmVhdGU9e3RoaXMuaGFuZGxlU25pcHBldENyZWF0ZX1cbiAgICAgICAgICAgIG9uRGVsZXRlPXt0aGlzLmhhbmRsZVNuaXBwZXREZWxldGV9XG4gICAgICAgICAgICBuYW1lPXtjb25maWcubmFtZX1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLnVwZGF0ZVNldHRpbmd9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgICAgPEZvbnRGYWNlIHsuLi5jb25maWd9IC8+XG4gICAgICAgIDxzdHlsZSBqc3g+XG4gICAgICAgICAge2BcbiAgICAgICAgICAgIC5lZGl0b3Ige1xuICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAke0NPTE9SUy5CTEFDS307XG4gICAgICAgICAgICAgIGJvcmRlcjogM3B4IHNvbGlkICR7Q09MT1JTLlNFQ09OREFSWX07XG4gICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDhweDtcbiAgICAgICAgICAgICAgcGFkZGluZzogMTZweDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLmJ1dHRvbnMge1xuICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgICBtYXJnaW4tbGVmdDogYXV0bztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC50b29sYmFyLXNlY29uZC1yb3cge1xuICAgICAgICAgICAgICBoZWlnaHQ6IDQwcHg7XG4gICAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgICAgICAgICAgIGZsZXg6IDEgMSBhdXRvO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLnRvb2xiYXItc2Vjb25kLXJvdyA+IDpnbG9iYWwoZGl2Om5vdCg6bGFzdC1vZi10eXBlKSkge1xuICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDAuNXJlbTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgI3N0eWxlLWVkaXRvci1idXR0b24ge1xuICAgICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIGB9XG4gICAgICAgIDwvc3R5bGU+XG4gICAgICA8L2Rpdj5cbiAgICApXG4gIH1cbn1cblxuRWRpdG9yLmRlZmF1bHRQcm9wcyA9IHtcbiAgb25VcGRhdGU6ICgpID0+IHt9LFxuICBvblJlc2V0OiAoKSA9PiB7fSxcbn1cblxuZXhwb3J0IGRlZmF1bHQgRWRpdG9yXG4iXX0= */\n/*@ sourceURL=/Users/limengyu/Desktop/private/code/project/show-codes/components/Editor.js */`\n      }, void 0, false, void 0, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 338,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\n_defineProperty(Editor, \"contextType\", ApiContext);\n\nEditor.defaultProps = {\n  onUpdate: () => {},\n  onReset: () => {}\n};\nexport default Editor;","map":{"version":3,"sources":["/Users/limengyu/Desktop/private/code/project/show-codes/components/Editor.js"],"names":["React","Dropzone","debounce","dynamic","ApiContext","Dropdown","Settings","Toolbar","Overlay","BackgroundSelect","Carbon","ExportMenu","CopyMenu","Themes","TweetButton","FontFace","LanguageIcon","LANGUAGES","LANGUAGE_MIME_HASH","LANGUAGE_MODE_HASH","LANGUAGE_NAME_HASH","DEFAULT_EXPORT_SIZE","COLORS","EXPORT_SIZES_HASH","DEFAULT_CODE","DEFAULT_SETTINGS","DEFAULT_LANGUAGE","DEFAULT_THEME","FONTS","serializeState","getRouteState","getSettings","unescapeHtml","formatCode","omit","dataURLtoBlob","domtoimage","languageIcon","SnippetToolbar","loading","getConfig","unsplashPhotographerCredit","Editor","Component","props","snippet","createRef","themes","find","t","id","state","theme","updates","onUpdate","trailing","leading","setState","code","updateState","width","widthAdjustment","format","type","squared","squaredImage","exportSize","value","node","carbonNode","current","offsetWidth","height","offsetHeight","config","style","transform","background","backgroundColor","filter","n","className","String","includes","fontFamily","toSvg","then","dataURL","replace","RegExp","uri","slice","indexOf","data","Blob","context","image","isSafari","themeConfig","getTheme","encodedState","highlights","toBlob","toPng","getCarbonImage","tweet","bind","options","link","document","createElement","prefix","filename","name","blob","window","URL","createObjectURL","url","download","isFirefox","target","href","body","appendChild","click","remove","navigator","clipboard","write","ClipboardItem","catch","console","error","key","Object","prototype","hasOwnProperty","call","preset","onReset","file","split","backgroundImage","content","backgroundImageSelection","backgroundMode","language","updateSetting","mime","mode","photographer","changes","updateThemes","updateTheme","settings","updateCode","create","setSnippet","setToasts","toasts","children","timeout","delete","componentDidMount","queryState","router","newState","localStorage","userAgent","render","BLACK","SECONDARY","updateHighlights","removeTheme","createTheme","updateLanguage","updateBackground","resetDefaultSettings","applyPreset","copyImage","exportImage","onDrop","canDrop","updateWidth","handleSnippetCreate","handleSnippetDelete","defaultProps"],"mappings":"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","sourcesContent":["// Theirs\nimport React from 'react'\nimport Dropzone from 'dropperx'\nimport debounce from 'lodash.debounce'\nimport dynamic from 'next/dynamic'\n\n// Ours\nimport ApiContext from './ApiContext'\nimport Dropdown from './Dropdown'\nimport Settings from './Settings'\nimport Toolbar from './Toolbar'\nimport Overlay from './Overlay'\nimport BackgroundSelect from './BackgroundSelect'\nimport Carbon from './Carbon'\nimport ExportMenu from './ExportMenu'\nimport CopyMenu from './CopyMenu'\nimport Themes from './Themes'\nimport TweetButton from './TweetButton'\nimport FontFace from './FontFace'\nimport LanguageIcon from './svg/Language'\nimport {\n  LANGUAGES,\n  LANGUAGE_MIME_HASH,\n  LANGUAGE_MODE_HASH,\n  LANGUAGE_NAME_HASH,\n  DEFAULT_EXPORT_SIZE,\n  COLORS,\n  EXPORT_SIZES_HASH,\n  DEFAULT_CODE,\n  DEFAULT_SETTINGS,\n  DEFAULT_LANGUAGE,\n  DEFAULT_THEME,\n  FONTS,\n} from '../lib/constants'\nimport { serializeState, getRouteState } from '../lib/routing'\nimport { getSettings, unescapeHtml, formatCode, omit, dataURLtoBlob } from '../lib/util'\nimport domtoimage from '../lib/dom-to-image'\n\nconst languageIcon = <LanguageIcon />\n\nconst SnippetToolbar = dynamic(() => import('./SnippetToolbar'), {\n  loading: () => null,\n})\n\nconst getConfig = omit(['code'])\nconst unsplashPhotographerCredit = /\\n\\n\\/\\/ Photo by.+?on Unsplash/\n\nclass Editor extends React.Component {\n  static contextType = ApiContext\n\n  state = {\n    ...DEFAULT_SETTINGS,\n    ...this.props.snippet,\n    loading: true,\n  }\n\n  async componentDidMount() {\n    const { queryState } = getRouteState(this.props.router)\n\n    const newState = {\n      // IDEA: we could create an interface for loading this config, so that it looks identical\n      // whether config is loaded from localStorage, gist, or even something like IndexDB\n      // Load options from gist or localStorage\n      ...(this.props.snippet ? null : getSettings(localStorage)),\n      // and then URL params\n      ...queryState,\n      loading: false,\n    }\n\n    // Makes sure the slash in 'application/X' is decoded\n    if (newState.language) {\n      newState.language = unescapeHtml(newState.language)\n    }\n\n    if (newState.fontFamily && !FONTS.find(({ id }) => id === newState.fontFamily)) {\n      newState.fontFamily = DEFAULT_SETTINGS.fontFamily\n    }\n\n    this.setState(newState)\n\n    this.isSafari =\n      window.navigator &&\n      window.navigator.userAgent.indexOf('Safari') !== -1 &&\n      window.navigator.userAgent.indexOf('Chrome') === -1\n    this.isFirefox =\n      window.navigator &&\n      window.navigator.userAgent.indexOf('Firefox') !== -1 &&\n      window.navigator.userAgent.indexOf('Chrome') === -1\n  }\n\n  carbonNode = React.createRef()\n\n  getTheme = () => this.props.themes.find(t => t.id === this.state.theme) || DEFAULT_THEME\n\n  onUpdate = debounce(updates => this.props.onUpdate(updates), 750, {\n    trailing: true,\n    leading: true,\n  })\n\n  updateState = updates => this.setState(updates, () => this.onUpdate(this.state))\n\n  updateCode = code => this.updateState({ code })\n  updateWidth = width => this.setState({ widthAdjustment: false, width })\n\n  getCarbonImage = async (\n    {\n      format,\n      type,\n      squared = this.state.squaredImage,\n      exportSize = (EXPORT_SIZES_HASH[this.state.exportSize] || DEFAULT_EXPORT_SIZE).value,\n    } = { format: 'png' }\n  ) => {\n    const node = this.carbonNode.current\n\n    const width = node.offsetWidth * exportSize\n    const height = squared ? node.offsetWidth * exportSize : node.offsetHeight * exportSize\n\n    const config = {\n      style: {\n        transform: `scale(${exportSize})`,\n        'transform-origin': 'center',\n        background: squared ? this.state.backgroundColor : 'none',\n      },\n      filter: n => {\n        if (n.className) {\n          const className = String(n.className)\n          if (className.includes('eliminateOnRender')) {\n            return false\n          }\n          if (className.includes('CodeMirror-cursors')) {\n            return false\n          }\n        }\n        return true\n      },\n      width,\n      height,\n    }\n\n    // current font-family used\n    const fontFamily = this.state.fontFamily\n\n    // TODO consolidate type/format to only use one param\n    if (format === 'svg') {\n      return domtoimage\n        .toSvg(node, config)\n        .then(dataURL =>\n          dataURL\n            .replace(/&nbsp;/g, '&#160;')\n            // https://github.com/tsayen/dom-to-image/blob/fae625bce0970b3a039671ea7f338d05ecb3d0e8/src/dom-to-image.js#L551\n            .replace(/%23/g, '#')\n            .replace(/%0A/g, '\\n')\n            // https://stackoverflow.com/questions/7604436/xmlparseentityref-no-name-warnings-while-loading-xml-into-a-php-file\n            .replace(/&(?!#?[a-z0-9]+;)/g, '&amp;')\n            // remove other fonts which are not used\n            .replace(\n              new RegExp('@font-face\\\\s+{\\\\s+font-family: (?!\"*' + fontFamily + ').*?}', 'g'),\n              ''\n            )\n        )\n        .then(uri => uri.slice(uri.indexOf(',') + 1))\n        .then(data => new Blob([data], { type: 'image/svg+xml' }))\n    }\n\n    // if safari, get image from api\n    if (this.context.image && this.isSafari) {\n      const themeConfig = this.getTheme()\n      // pull from custom theme highlights, or state highlights\n      const encodedState = serializeState({\n        ...this.state,\n        highlights: { ...themeConfig.highlights, ...this.state.highlights },\n      })\n      // TODO consider returning blob responseType from axios\n      return this.context\n        .image(encodedState)\n        .then(dataURL => (type === 'blob' ? dataURLtoBlob(dataURL) : dataURL))\n    }\n\n    if (type === 'blob') {\n      return domtoimage.toBlob(node, config)\n    }\n\n    // Twitter needs regular dataURLs\n    return domtoimage.toPng(node, config)\n  }\n\n  tweet = () => {\n    this.getCarbonImage({ format: 'png' }).then(\n      this.context.tweet.bind(null, this.state.code || DEFAULT_CODE)\n    )\n  }\n\n  exportImage = (format = 'png', options = {}) => {\n    const link = document.createElement('a')\n\n    const prefix = options.filename || this.state.name || 'carbon'\n\n    return this.getCarbonImage({ format, type: 'blob' })\n      .then(blob => window.URL.createObjectURL(blob))\n      .then(url => {\n        if (format !== 'open') {\n          link.download = `${prefix}.${format}`\n        }\n        if (this.isFirefox) {\n          link.target = '_blank'\n        }\n        link.href = url\n        document.body.appendChild(link)\n        link.click()\n        link.remove()\n      })\n  }\n\n  copyImage = () =>\n    this.getCarbonImage({ format: 'png', type: 'blob' })\n      .then(blob =>\n        navigator.clipboard.write([\n          new window.ClipboardItem({\n            [blob.type]: blob,\n          }),\n        ])\n      )\n      .catch(console.error)\n\n  updateSetting = (key, value) => {\n    this.updateState({ [key]: value })\n    if (Object.prototype.hasOwnProperty.call(DEFAULT_SETTINGS, key)) {\n      this.updateState({ preset: null })\n    }\n  }\n\n  resetDefaultSettings = () => {\n    this.updateState(DEFAULT_SETTINGS)\n    this.props.onReset()\n  }\n\n  onDrop = ([file]) => {\n    if (file.type.split('/')[0] === 'image') {\n      this.updateState({\n        backgroundImage: file.content,\n        backgroundImageSelection: null,\n        backgroundMode: 'image',\n        preset: null,\n      })\n    } else {\n      this.updateState({ code: file.content, language: 'auto' })\n    }\n  }\n\n  updateLanguage = language => {\n    if (language) {\n      this.updateSetting('language', language.mime || language.mode)\n    }\n  }\n\n  updateBackground = ({ photographer, ...changes } = {}) => {\n    if (photographer) {\n      this.updateState(({ code = DEFAULT_CODE }) => ({\n        ...changes,\n        code:\n          code.replace(unsplashPhotographerCredit, '') +\n          `\\n\\n// Photo by ${photographer.name} on Unsplash`,\n        preset: null,\n      }))\n    } else {\n      this.updateState({ ...changes, preset: null })\n    }\n  }\n\n  updateTheme = theme => this.updateState({ theme })\n  updateHighlights = updates =>\n    this.setState(({ highlights = {} }) => ({\n      highlights: {\n        ...highlights,\n        ...updates,\n      },\n    }))\n\n  createTheme = theme => {\n    this.props.updateThemes(themes => [theme, ...themes])\n    this.updateTheme(theme.id)\n  }\n\n  removeTheme = id => {\n    this.props.updateThemes(themes => themes.filter(t => t.id !== id))\n    if (this.state.theme.id === id) {\n      this.updateTheme(DEFAULT_THEME.id)\n    }\n  }\n\n  applyPreset = ({ id: preset, ...settings }) => this.updateState({ preset, ...settings })\n\n  format = () =>\n    formatCode(this.state.code)\n      .then(this.updateCode)\n      .catch(() => {\n        // create toast here in the future\n      })\n\n  handleSnippetCreate = () =>\n    this.context.snippet\n      .create(this.state)\n      .then(data => this.props.setSnippet(data))\n      .then(() =>\n        this.props.setToasts({\n          type: 'SET',\n          toasts: [{ children: 'Snippet duplicated!', timeout: 3000 }],\n        })\n      )\n\n  handleSnippetDelete = () =>\n    this.context.snippet\n      .delete(this.props.snippet.id)\n      .then(() => this.props.setSnippet(null))\n      .then(() =>\n        this.props.setToasts({\n          type: 'SET',\n          toasts: [{ children: 'Snippet deleted', timeout: 3000 }],\n        })\n      )\n\n  render() {\n    const {\n      highlights,\n      language,\n      backgroundColor,\n      backgroundImage,\n      backgroundMode,\n      code,\n      exportSize,\n    } = this.state\n\n    const config = getConfig(this.state)\n\n    const theme = this.getTheme()\n\n    return (\n      <div className=\"editor\">\n        <Toolbar>\n          <Themes\n            theme={theme}\n            highlights={highlights}\n            update={this.updateTheme}\n            updateHighlights={this.updateHighlights}\n            remove={this.removeTheme}\n            create={this.createTheme}\n            themes={this.props.themes}\n          />\n          <Dropdown\n            title=\"Language\"\n            icon={languageIcon}\n            selected={\n              LANGUAGE_NAME_HASH[language] ||\n              LANGUAGE_MIME_HASH[language] ||\n              LANGUAGE_MODE_HASH[language] ||\n              LANGUAGE_MODE_HASH[DEFAULT_LANGUAGE]\n            }\n            list={LANGUAGES}\n            onChange={this.updateLanguage}\n          />\n          <div className=\"toolbar-second-row\">\n            <BackgroundSelect\n              onChange={this.updateBackground}\n              updateHighlights={this.updateHighlights}\n              mode={backgroundMode}\n              color={backgroundColor}\n              image={backgroundImage}\n              carbonRef={this.carbonNode.current}\n            />\n            <Settings\n              {...config}\n              onChange={this.updateSetting}\n              resetDefaultSettings={this.resetDefaultSettings}\n              format={this.format}\n              applyPreset={this.applyPreset}\n              getCarbonImage={this.getCarbonImage}\n            />\n            <div id=\"style-editor-button\" />\n            <div className=\"buttons\">\n              <CopyMenu copyImage={this.copyImage} carbonRef={this.carbonNode.current} />\n              <TweetButton onClick={this.tweet} />\n              <ExportMenu\n                onChange={this.updateSetting}\n                exportImage={this.exportImage}\n                exportSize={exportSize}\n                backgroundImage={backgroundImage}\n              />\n            </div>\n          </div>\n        </Toolbar>\n\n        <Dropzone accept=\"image/*, text/*, application/*\" onDrop={this.onDrop}>\n          {({ canDrop }) => (\n            <Overlay\n              isOver={canDrop}\n              title={`Drop your file here to import ${canDrop ? '✋' : '✊'}`}\n            >\n              {/*key ensures Carbon's internal language state is updated when it's changed by Dropdown*/}\n              <Carbon\n                key={language}\n                ref={this.carbonNode}\n                config={this.state}\n                onChange={this.updateCode}\n                updateWidth={this.updateWidth}\n                loading={this.state.loading}\n                theme={theme}\n              >\n                {code != null ? code : DEFAULT_CODE}\n              </Carbon>\n            </Overlay>\n          )}\n        </Dropzone>\n        {this.props.snippet && (\n          <SnippetToolbar\n            snippet={this.props.snippet}\n            onCreate={this.handleSnippetCreate}\n            onDelete={this.handleSnippetDelete}\n            name={config.name}\n            onChange={this.updateSetting}\n          />\n        )}\n        <FontFace {...config} />\n        <style jsx>\n          {`\n            .editor {\n              background: ${COLORS.BLACK};\n              border: 3px solid ${COLORS.SECONDARY};\n              border-radius: 8px;\n              padding: 16px;\n            }\n\n            .buttons {\n              display: flex;\n              margin-left: auto;\n            }\n            .toolbar-second-row {\n              height: 40px;\n              display: flex;\n              flex: 1 1 auto;\n            }\n            .toolbar-second-row > :global(div:not(:last-of-type)) {\n              margin-right: 0.5rem;\n            }\n\n            #style-editor-button {\n              display: flex;\n              align-items: center;\n            }\n          `}\n        </style>\n      </div>\n    )\n  }\n}\n\nEditor.defaultProps = {\n  onUpdate: () => {},\n  onReset: () => {},\n}\n\nexport default Editor\n"]},"metadata":{},"sourceType":"module"}