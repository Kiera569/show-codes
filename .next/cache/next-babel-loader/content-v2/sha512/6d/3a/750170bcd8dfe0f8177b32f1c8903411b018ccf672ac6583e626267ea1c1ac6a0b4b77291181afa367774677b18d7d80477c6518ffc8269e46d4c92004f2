{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/limengyu/Desktop/private/code/project/show-codes/components/EditorContainer.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n// Theirs\nimport React from 'react';\nimport Router from 'next/router';\nimport { useAsyncCallback } from 'actionsack';\nimport Editor from './Editor';\nimport Toasts from './Toasts';\nimport { useAPI } from './ApiContext';\nimport { useAuth } from './AuthContext';\nimport { THEMES } from '../lib/constants';\nimport { updateRouteState } from '../lib/routing';\nimport { getThemes, saveThemes, clearSettings, saveSettings } from '../lib/util';\n\nfunction onReset() {\n  clearSettings();\n  updateRouteState(Router, {});\n\n  if (window.navigator && navigator.serviceWorker) {\n    navigator.serviceWorker.getRegistrations().then(registrations => {\n      registrations.forEach(registration => {\n        registration.unregister();\n      });\n    });\n  }\n}\n\nfunction toastsReducer(curr, action) {\n  switch (action.type) {\n    case 'ADD':\n      {\n        if (!curr.find(t => t.children === action.toast.children)) {\n          return curr.concat(action.toast);\n        }\n\n        return curr;\n      }\n\n    case 'SET':\n      {\n        return action.toasts;\n      }\n  }\n\n  throw new Error('Unsupported action');\n}\n\nfunction EditorContainer(props) {\n  const [themes, updateThemes] = React.useState(THEMES);\n  const api = useAPI();\n  const user = useAuth();\n  const [update, {\n    loading\n  }] = useAsyncCallback(api.snippet.update);\n  React.useEffect(() => {\n    const storedThemes = getThemes(localStorage) || [];\n\n    if (storedThemes) {\n      updateThemes(currentThemes => [...storedThemes, ...currentThemes]);\n    }\n  }, []);\n  React.useEffect(() => {\n    saveThemes(themes.filter(({\n      custom\n    }) => custom));\n  }, [themes]); // XXX use context\n\n  const [snippet, setSnippet] = React.useState(props.snippet || null);\n  const [toasts, setToasts] = React.useReducer(toastsReducer, []);\n  const snippetId = snippet && snippet.id;\n  React.useEffect(() => {\n    if ('/' + (snippetId || '') === props.router.asPath) {\n      return;\n    }\n\n    window.history.pushState(null, null, '/' + (snippetId || '')); // props.router.replace(props.router.asPath, '/' + (snippetId || ''), { shallow: true })\n  }, [snippetId, props.router]);\n\n  function onEditorUpdate(state) {\n    if (loading) {\n      return;\n    }\n\n    if (!user) {\n      updateRouteState(props.router, state);\n      saveSettings(state);\n    } else {\n      const updates = state;\n\n      if (!snippet) {\n        update(snippetId, updates).then(newSnippet => {\n          if (newSnippet && newSnippet.id) {\n            setSnippet(newSnippet);\n            setToasts({\n              type: 'ADD',\n              toast: {\n                children: 'Snippet saved!',\n                closable: true\n              }\n            });\n          }\n        });\n      } else if (snippet.userId === user.uid) {\n        update(snippetId, updates).then(() => {\n          setToasts({\n            type: 'ADD',\n            toast: {\n              children: 'Snippet saved!',\n              closable: true\n            }\n          });\n        });\n      }\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Toasts, {\n      toasts: toasts\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Editor, _objectSpread(_objectSpread({}, props), {}, {\n      themes: themes,\n      updateThemes: updateThemes,\n      snippet: snippet,\n      setSnippet: setSnippet,\n      setToasts: setToasts,\n      onUpdate: onEditorUpdate,\n      onReset: onReset\n    }), void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n\nexport default EditorContainer;","map":{"version":3,"sources":["/Users/limengyu/Desktop/private/code/project/show-codes/components/EditorContainer.js"],"names":["React","Router","useAsyncCallback","Editor","Toasts","useAPI","useAuth","THEMES","updateRouteState","getThemes","saveThemes","clearSettings","saveSettings","onReset","window","navigator","serviceWorker","getRegistrations","then","registrations","forEach","registration","unregister","toastsReducer","curr","action","type","find","t","children","toast","concat","toasts","Error","EditorContainer","props","themes","updateThemes","useState","api","user","update","loading","snippet","useEffect","storedThemes","localStorage","currentThemes","filter","custom","setSnippet","setToasts","useReducer","snippetId","id","router","asPath","history","pushState","onEditorUpdate","state","updates","newSnippet","closable","userId","uid"],"mappings":"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","sourcesContent":["// Theirs\nimport React from 'react'\nimport Router from 'next/router'\nimport { useAsyncCallback } from 'actionsack'\n\nimport Editor from './Editor'\nimport Toasts from './Toasts'\nimport { useAPI } from './ApiContext'\nimport { useAuth } from './AuthContext'\n\nimport { THEMES } from '../lib/constants'\nimport { updateRouteState } from '../lib/routing'\nimport { getThemes, saveThemes, clearSettings, saveSettings } from '../lib/util'\n\nfunction onReset() {\n  clearSettings()\n  updateRouteState(Router, {})\n\n  if (window.navigator && navigator.serviceWorker) {\n    navigator.serviceWorker.getRegistrations().then(registrations => {\n      registrations.forEach(registration => {\n        registration.unregister()\n      })\n    })\n  }\n}\n\nfunction toastsReducer(curr, action) {\n  switch (action.type) {\n    case 'ADD': {\n      if (!curr.find(t => t.children === action.toast.children)) {\n        return curr.concat(action.toast)\n      }\n      return curr\n    }\n    case 'SET': {\n      return action.toasts\n    }\n  }\n  throw new Error('Unsupported action')\n}\n\nfunction EditorContainer(props) {\n  const [themes, updateThemes] = React.useState(THEMES)\n  const api = useAPI()\n  const user = useAuth()\n  const [update, { loading }] = useAsyncCallback(api.snippet.update)\n\n  React.useEffect(() => {\n    const storedThemes = getThemes(localStorage) || []\n    if (storedThemes) {\n      updateThemes(currentThemes => [...storedThemes, ...currentThemes])\n    }\n  }, [])\n\n  React.useEffect(() => {\n    saveThemes(themes.filter(({ custom }) => custom))\n  }, [themes])\n\n  // XXX use context\n  const [snippet, setSnippet] = React.useState(props.snippet || null)\n  const [toasts, setToasts] = React.useReducer(toastsReducer, [])\n\n  const snippetId = snippet && snippet.id\n  React.useEffect(() => {\n    if ('/' + (snippetId || '') === props.router.asPath) {\n      return\n    }\n    window.history.pushState(null, null, '/' + (snippetId || ''))\n    // props.router.replace(props.router.asPath, '/' + (snippetId || ''), { shallow: true })\n  }, [snippetId, props.router])\n\n  function onEditorUpdate(state) {\n    if (loading) {\n      return\n    }\n\n    if (!user) {\n      updateRouteState(props.router, state)\n      saveSettings(state)\n    } else {\n      const updates = state\n      if (!snippet) {\n        update(snippetId, updates).then(newSnippet => {\n          if (newSnippet && newSnippet.id) {\n            setSnippet(newSnippet)\n            setToasts({\n              type: 'ADD',\n              toast: { children: 'Snippet saved!', closable: true },\n            })\n          }\n        })\n      } else if (snippet.userId === user.uid) {\n        update(snippetId, updates).then(() => {\n          setToasts({\n            type: 'ADD',\n            toast: { children: 'Snippet saved!', closable: true },\n          })\n        })\n      }\n    }\n  }\n\n  return (\n    <>\n      <Toasts toasts={toasts} />\n      <Editor\n        {...props}\n        themes={themes}\n        updateThemes={updateThemes}\n        snippet={snippet}\n        setSnippet={setSnippet}\n        setToasts={setToasts}\n        onUpdate={onEditorUpdate}\n        onReset={onReset}\n      />\n    </>\n  )\n}\n\nexport default EditorContainer\n"]},"metadata":{},"sourceType":"module"}