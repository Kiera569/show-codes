{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _toConsumableArray from \"/Users/limengyu/Desktop/private/code/project/show-codes/node_modules/next/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"/Users/limengyu/Desktop/private/code/project/show-codes/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/limengyu/Desktop/private/code/project/show-codes/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"/Users/limengyu/Desktop/private/code/project/show-codes/components/RandomImage.js\",\n    _s = $RefreshSig$();\n\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React from 'react';\nimport { useAsyncCallback } from 'actionsack';\nimport { Spinner } from './SpinnerWrapper';\nimport { useAPI } from './ApiContext';\nimport PhotoCredit from './PhotoCredit';\n\nfunction RandomImage(props) {\n  _s();\n\n  var cacheRef = React.useRef([]);\n\n  var _React$useState = React.useState(0),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      cacheIndex = _React$useState2[0],\n      updateIndex = _React$useState2[1];\n\n  var api = useAPI();\n\n  var _useAsyncCallback = useAsyncCallback(function () {\n    var image = cacheRef.current[cacheIndex];\n    return api.unsplash.download(image.id).then(function (data) {\n      return props.onChange(_objectSpread(_objectSpread({}, image), data));\n    });\n  }),\n      _useAsyncCallback2 = _slicedToArray(_useAsyncCallback, 2),\n      selectImage = _useAsyncCallback2[0],\n      selecting = _useAsyncCallback2[1].loading;\n\n  var _useAsyncCallback3 = useAsyncCallback(api.unsplash.random),\n      _useAsyncCallback4 = _slicedToArray(_useAsyncCallback3, 2),\n      updateCache = _useAsyncCallback4[0],\n      _useAsyncCallback4$ = _useAsyncCallback4[1],\n      updating = _useAsyncCallback4$.loading,\n      error = _useAsyncCallback4$.error,\n      imgs = _useAsyncCallback4$.data;\n\n  var needsFetch = !error && !updating && (!imgs || cacheIndex > cacheRef.current.length - 2);\n  React.useEffect(function () {\n    if (needsFetch) {\n      updateCache();\n    }\n  }, [needsFetch, updateCache]);\n  React.useEffect(function () {\n    if (imgs) {\n      var _cacheRef$current;\n\n      (_cacheRef$current = cacheRef.current).push.apply(_cacheRef$current, _toConsumableArray(imgs));\n    }\n  }, [imgs]);\n  var loading = updating || selecting;\n  var cache = cacheRef.current;\n  var photographer = cache[cacheIndex] && cache[cacheIndex].photographer;\n  var bgImage = cache[cacheIndex] && cache[cacheIndex].dataURL;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: _JSXStyle.dynamic([[\"3782579021\", [bgImage, loading ? 0.5 : 1, loading ? 'not-allowed' : 'pointer']]]) + \" \" + \"random-image-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: _JSXStyle.dynamic([[\"3782579021\", [bgImage, loading ? 0.5 : 1, loading ? 'not-allowed' : 'pointer']]]) + \" \" + \"controls\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        disabled: loading,\n        onClick: selectImage,\n        className: _JSXStyle.dynamic([[\"3782579021\", [bgImage, loading ? 0.5 : 1, loading ? 'not-allowed' : 'pointer']]]),\n        children: \"Use Image\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        disabled: loading,\n        onClick: function onClick() {\n          return updateIndex(function (i) {\n            return i + 1;\n          });\n        },\n        className: _JSXStyle.dynamic([[\"3782579021\", [bgImage, loading ? 0.5 : 1, loading ? 'not-allowed' : 'pointer']]]),\n        children: \"Try Another\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: _JSXStyle.dynamic([[\"3782579021\", [bgImage, loading ? 0.5 : 1, loading ? 'not-allowed' : 'pointer']]]) + \" \" + \"image\",\n      children: loading && /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 42\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 7\n    }, this), photographer && /*#__PURE__*/_jsxDEV(PhotoCredit, {\n      photographer: photographer\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 24\n    }, this), /*#__PURE__*/_jsxDEV(_JSXStyle, {\n      id: \"3782579021\",\n      dynamic: [bgImage, loading ? 0.5 : 1, loading ? 'not-allowed' : 'pointer'],\n      children: \".image.__jsx-style-dynamic-selector{width:100%;height:140px;background:url(\".concat(bgImage, \");background-size:cover;background-repeat:no-repeat;margin-bottom:4px;}.controls.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin-bottom:4px;}button.__jsx-style-dynamic-selector{opacity:\").concat(loading ? 0.5 : 1, \";cursor:\").concat(loading ? 'not-allowed' : 'pointer', \";-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;border:none;background:none;color:inherit;font-size:inherit;padding:0;}button.__jsx-style-dynamic-selector:focus{outline:none;-webkit-text-decoration:underline;text-decoration:underline;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9saW1lbmd5dS9EZXNrdG9wL3ByaXZhdGUvY29kZS9wcm9qZWN0L3Nob3ctY29kZXMvY29tcG9uZW50cy9SYW5kb21JbWFnZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFzRFMsQUFHd0IsQUFTRSxBQU13QixBQVl4QixXQTFCQSxFQTJCYSxXQTFCbUIsYUFjVCxnQ0FiZCxJQWNMLEFBWW5CLENBbkJnQyxpQkFORiw0QkFDVixrQkFDcEIscUJBWWtCLCtCQVBFLGtCQUNwQixZQU9jLFlBQ0ksZ0JBQ0YsY0FDSSxrQkFDUixVQUNaIiwiZmlsZSI6Ii9Vc2Vycy9saW1lbmd5dS9EZXNrdG9wL3ByaXZhdGUvY29kZS9wcm9qZWN0L3Nob3ctY29kZXMvY29tcG9uZW50cy9SYW5kb21JbWFnZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcbmltcG9ydCB7IHVzZUFzeW5jQ2FsbGJhY2sgfSBmcm9tICdhY3Rpb25zYWNrJ1xuXG5pbXBvcnQgeyBTcGlubmVyIH0gZnJvbSAnLi9TcGlubmVyV3JhcHBlcidcbmltcG9ydCB7IHVzZUFQSSB9IGZyb20gJy4vQXBpQ29udGV4dCdcbmltcG9ydCBQaG90b0NyZWRpdCBmcm9tICcuL1Bob3RvQ3JlZGl0J1xuXG5mdW5jdGlvbiBSYW5kb21JbWFnZShwcm9wcykge1xuICBjb25zdCBjYWNoZVJlZiA9IFJlYWN0LnVzZVJlZihbXSlcbiAgY29uc3QgW2NhY2hlSW5kZXgsIHVwZGF0ZUluZGV4XSA9IFJlYWN0LnVzZVN0YXRlKDApXG4gIGNvbnN0IGFwaSA9IHVzZUFQSSgpXG5cbiAgY29uc3QgW3NlbGVjdEltYWdlLCB7IGxvYWRpbmc6IHNlbGVjdGluZyB9XSA9IHVzZUFzeW5jQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IGltYWdlID0gY2FjaGVSZWYuY3VycmVudFtjYWNoZUluZGV4XVxuXG4gICAgcmV0dXJuIGFwaS51bnNwbGFzaC5kb3dubG9hZChpbWFnZS5pZCkudGhlbihkYXRhID0+IHByb3BzLm9uQ2hhbmdlKHsgLi4uaW1hZ2UsIC4uLmRhdGEgfSkpXG4gIH0pXG5cbiAgY29uc3QgW3VwZGF0ZUNhY2hlLCB7IGxvYWRpbmc6IHVwZGF0aW5nLCBlcnJvciwgZGF0YTogaW1ncyB9XSA9IHVzZUFzeW5jQ2FsbGJhY2soXG4gICAgYXBpLnVuc3BsYXNoLnJhbmRvbVxuICApXG5cbiAgY29uc3QgbmVlZHNGZXRjaCA9ICFlcnJvciAmJiAhdXBkYXRpbmcgJiYgKCFpbWdzIHx8IGNhY2hlSW5kZXggPiBjYWNoZVJlZi5jdXJyZW50Lmxlbmd0aCAtIDIpXG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAobmVlZHNGZXRjaCkge1xuICAgICAgdXBkYXRlQ2FjaGUoKVxuICAgIH1cbiAgfSwgW25lZWRzRmV0Y2gsIHVwZGF0ZUNhY2hlXSlcblxuICBSZWFjdC51c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChpbWdzKSB7XG4gICAgICBjYWNoZVJlZi5jdXJyZW50LnB1c2goLi4uaW1ncylcbiAgICB9XG4gIH0sIFtpbWdzXSlcblxuICBjb25zdCBsb2FkaW5nID0gdXBkYXRpbmcgfHwgc2VsZWN0aW5nXG5cbiAgY29uc3QgY2FjaGUgPSBjYWNoZVJlZi5jdXJyZW50XG4gIGNvbnN0IHBob3RvZ3JhcGhlciA9IGNhY2hlW2NhY2hlSW5kZXhdICYmIGNhY2hlW2NhY2hlSW5kZXhdLnBob3RvZ3JhcGhlclxuICBjb25zdCBiZ0ltYWdlID0gY2FjaGVbY2FjaGVJbmRleF0gJiYgY2FjaGVbY2FjaGVJbmRleF0uZGF0YVVSTFxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPVwicmFuZG9tLWltYWdlLWNvbnRhaW5lclwiPlxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJjb250cm9sc1wiPlxuICAgICAgICA8YnV0dG9uIGRpc2FibGVkPXtsb2FkaW5nfSBvbkNsaWNrPXtzZWxlY3RJbWFnZX0+XG4gICAgICAgICAgVXNlIEltYWdlXG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uIGRpc2FibGVkPXtsb2FkaW5nfSBvbkNsaWNrPXsoKSA9PiB1cGRhdGVJbmRleChpID0+IGkgKyAxKX0+XG4gICAgICAgICAgVHJ5IEFub3RoZXJcbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaW1hZ2VcIj57bG9hZGluZyAmJiA8U3Bpbm5lciAvPn08L2Rpdj5cbiAgICAgIHtwaG90b2dyYXBoZXIgJiYgPFBob3RvQ3JlZGl0IHBob3RvZ3JhcGhlcj17cGhvdG9ncmFwaGVyfSAvPn1cbiAgICAgIDxzdHlsZSBqc3g+XG4gICAgICAgIHtgXG4gICAgICAgICAgLmltYWdlIHtcbiAgICAgICAgICAgIHdpZHRoOiAxMDAlO1xuICAgICAgICAgICAgaGVpZ2h0OiAxNDBweDtcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IHVybCgke2JnSW1hZ2V9KTtcbiAgICAgICAgICAgIGJhY2tncm91bmQtc2l6ZTogY292ZXI7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0O1xuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNHB4O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC5jb250cm9scyB7XG4gICAgICAgICAgICBkaXNwbGF5OiBmbGV4O1xuICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogNHB4O1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJ1dHRvbiB7XG4gICAgICAgICAgICBvcGFjaXR5OiAke2xvYWRpbmcgPyAwLjUgOiAxfTtcbiAgICAgICAgICAgIGN1cnNvcjogJHtsb2FkaW5nID8gJ25vdC1hbGxvd2VkJyA6ICdwb2ludGVyJ307XG4gICAgICAgICAgICB1c2VyLXNlbGVjdDogbm9uZTtcbiAgICAgICAgICAgIGFwcGVhcmFuY2U6IG5vbmU7XG4gICAgICAgICAgICBib3JkZXI6IG5vbmU7XG4gICAgICAgICAgICBiYWNrZ3JvdW5kOiBub25lO1xuICAgICAgICAgICAgY29sb3I6IGluaGVyaXQ7XG4gICAgICAgICAgICBmb250LXNpemU6IGluaGVyaXQ7XG4gICAgICAgICAgICBwYWRkaW5nOiAwO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGJ1dHRvbjpmb2N1cyB7XG4gICAgICAgICAgICBvdXRsaW5lOiBub25lO1xuICAgICAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiB1bmRlcmxpbmU7XG4gICAgICAgICAgfVxuICAgICAgICBgfVxuICAgICAgPC9zdHlsZT5cbiAgICA8L2Rpdj5cbiAgKVxufVxuXG5leHBvcnQgZGVmYXVsdCBSYW5kb21JbWFnZVxuIl19 */\\n/*@ sourceURL=/Users/limengyu/Desktop/private/code/project/show-codes/components/RandomImage.js */\")\n    }, void 0, false, void 0, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 5\n  }, this);\n}\n\n_s(RandomImage, \"pheGNDCC0iJcQFSq6vOqfKT9AEQ=\", false, function () {\n  return [useAPI, useAsyncCallback, useAsyncCallback];\n});\n\n_c = RandomImage;\nexport default RandomImage;\n\nvar _c;\n\n$RefreshReg$(_c, \"RandomImage\");","map":{"version":3,"sources":["/Users/limengyu/Desktop/private/code/project/show-codes/components/RandomImage.js"],"names":["React","useAsyncCallback","Spinner","useAPI","PhotoCredit","RandomImage","props","cacheRef","useRef","useState","cacheIndex","updateIndex","api","image","current","unsplash","download","id","then","data","onChange","selectImage","selecting","loading","random","updateCache","updating","error","imgs","needsFetch","length","useEffect","push","cache","photographer","bgImage","dataURL","i"],"mappings":"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","sourcesContent":["import React from 'react'\nimport { useAsyncCallback } from 'actionsack'\n\nimport { Spinner } from './SpinnerWrapper'\nimport { useAPI } from './ApiContext'\nimport PhotoCredit from './PhotoCredit'\n\nfunction RandomImage(props) {\n  const cacheRef = React.useRef([])\n  const [cacheIndex, updateIndex] = React.useState(0)\n  const api = useAPI()\n\n  const [selectImage, { loading: selecting }] = useAsyncCallback(() => {\n    const image = cacheRef.current[cacheIndex]\n\n    return api.unsplash.download(image.id).then(data => props.onChange({ ...image, ...data }))\n  })\n\n  const [updateCache, { loading: updating, error, data: imgs }] = useAsyncCallback(\n    api.unsplash.random\n  )\n\n  const needsFetch = !error && !updating && (!imgs || cacheIndex > cacheRef.current.length - 2)\n\n  React.useEffect(() => {\n    if (needsFetch) {\n      updateCache()\n    }\n  }, [needsFetch, updateCache])\n\n  React.useEffect(() => {\n    if (imgs) {\n      cacheRef.current.push(...imgs)\n    }\n  }, [imgs])\n\n  const loading = updating || selecting\n\n  const cache = cacheRef.current\n  const photographer = cache[cacheIndex] && cache[cacheIndex].photographer\n  const bgImage = cache[cacheIndex] && cache[cacheIndex].dataURL\n  return (\n    <div className=\"random-image-container\">\n      <div className=\"controls\">\n        <button disabled={loading} onClick={selectImage}>\n          Use Image\n        </button>\n        <button disabled={loading} onClick={() => updateIndex(i => i + 1)}>\n          Try Another\n        </button>\n      </div>\n      <div className=\"image\">{loading && <Spinner />}</div>\n      {photographer && <PhotoCredit photographer={photographer} />}\n      <style jsx>\n        {`\n          .image {\n            width: 100%;\n            height: 140px;\n            background: url(${bgImage});\n            background-size: cover;\n            background-repeat: no-repeat;\n            margin-bottom: 4px;\n          }\n\n          .controls {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 4px;\n          }\n\n          button {\n            opacity: ${loading ? 0.5 : 1};\n            cursor: ${loading ? 'not-allowed' : 'pointer'};\n            user-select: none;\n            appearance: none;\n            border: none;\n            background: none;\n            color: inherit;\n            font-size: inherit;\n            padding: 0;\n          }\n\n          button:focus {\n            outline: none;\n            text-decoration: underline;\n          }\n        `}\n      </style>\n    </div>\n  )\n}\n\nexport default RandomImage\n"]},"metadata":{},"sourceType":"module"}