const format = require('.')

const testMarkdown = `markdown`

test.each([
  ['https://google.com', 'https://google.com'],
  ['http://google.com', 'http://google.com'],
  ['carbon.now.sh', 'https://carbon.now.sh']
])('it should format "%s" correctly', async (url, exp) => {
  process.env = { NOW_URL: url }
  const formatted = await format(testMarkdown)

  expect(formatted).toEqual([`\`now-release\`: ${exp}`, '', testMarkdown].join('\n'))
})

test.each(['some random string', 'word'])('it should format "%s" correctly', async url => {
  process.env = { NOW_URL: url }
  const formatted = await format(testMarkdown)

  expect(formatted).toEqual(testMarkdown)
})

test('it should read from now.json if present', async () => {
  process.env = { NOW_URL: 'https://google.com' }
  jest.mock('./now.json', () => ({ name: 'fake-name' }), { virtual: true })

  const formatted = await format(testMarkdown)

  expect(formatted).toEqual(['`fake-name`: https://google.com', '', testMarkdown].join('\n'))
})
