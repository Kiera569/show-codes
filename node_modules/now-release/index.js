const path = require('path')
const clipboardy = require('clipboardy')
const normalizeUrl = require('normalize-url')

module.exports = async markdown => {
  let URL = process.env.URL || process.env.NOW_URL || clipboardy.readSync()

  if (URL.indexOf('.') > -1 && !URL.trim().match(/\s/)) {
    URL = normalizeUrl(URL, { defaultProtocol: 'https:' })

    let name
    try {
      name = require(path.resolve(process.cwd(), 'now.json')).name
    } catch (e) {
      /* pass */
    }

    if (!name) {
      try {
        name = require(path.resolve(process.cwd(), 'package.json')).name
      } catch (e) {
        /* pass */
      }
    }

    const prefix = name ? `\`${name}\`: ` : ''

    return [`${prefix}${URL}`, '', markdown].join('\n')
  }

  // Use the available data to create a custom release
  return markdown
}
